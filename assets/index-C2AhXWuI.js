import{a8 as D,p as R,ac as x,_ as A,o as N,c as G,ad as P}from"./app-BIv4BGsj.js";import{c as U,p as z,u as J}from"./index-XVBT3eyP.js";const q=n=>Object.assign({},U,{sourceUrl:{type:String},sourceData:{type:Object},geoBufferSource:{type:[ArrayBuffer,String],default(){return null}},layerStyle:{type:Object},defaultStyleValue:{type:Object,default(){return{}}},zooms:{type:Array},opacity:{type:Number},initEvents:{type:Boolean,default:!0},visibleDuration:{type:Number,default:0},onClick:{type:Function,default:null},onMousemove:{type:Function,default:null},onRightclick:{type:Function,default:null}},n),K=["init","mousemove","click","rightclick"];function Q(n){return{__layerStyle(i){D(()=>{var r;(r=n.$amapComponent())!=null&&r.setStyle&&n.$amapComponent().setStyle(i)}).then()},__sourceUrl(){D(()=>{n.setSource()}).then()},__sourceData(){D(()=>{n.setSource()}).then()},__geoBufferSource(){D(()=>{n.setSource()}).then()},__visible(i){const r=n.$amapComponent();r!=null&&r.show&&(r!=null&&r.hide)&&(i?r.show(n.props.visibleDuration):r.hide(n.props.visibleDuration))}}}function X(n){let i=!1,r=!1,a;const{parentInstance:s,$amapComponent:c,emits:l,props:o,setStyle:p}=n,f=()=>{a&&(a.destroy(),a=null),o.geoBufferSource?typeof o.geoBufferSource=="string"?a=new Loca.GeoBufferSource({url:o.geoBufferSource}):a=new Loca.GeoBufferSource({data:o.geoBufferSource}):o.sourceUrl?a=new Loca.GeoJSONSource({url:o.sourceUrl}):o.sourceData?a=new Loca.GeoJSONSource({data:o.sourceData}):a=new Loca.GeoJSONSource({}),c.setSource(a)},S=()=>{o.initEvents&&$()},$=()=>{if(s){const t=s.getMap();o.onClick!==null&&t.on("click",m),o.onMousemove!==null&&(t.on("mousemove",M),t.on("dragstart",_),t.on("dragend",k),t.on("rotatestart",L),t.on("rotateend",b),t.on("mouseout",h)),o.onRightclick!==null&&t.on("rightclick",g)}},m=t=>{const d=y(t);l("click",d,t)},g=t=>{const d=y(t);l("rightclick",d,t)},M=t=>{if(i||r)return;const d=y(t);l("mousemove",d,t)},y=t=>c.queryFeature(t.pixel.toArray()),_=()=>{i=!0},k=()=>{i=!1},h=()=>{i=!1,r=!1},L=()=>{r=!0},b=()=>{r=!1},E=()=>{if(s){const t=s.getMap();t.off("click",m),t.off("rightclick",g),t.off("mousemove",M),t.off("dragstart",_),t.off("dragend",k),t.off("rotatestart",L),t.off("rotateend",b),t.off("mouseout",h)}};return f(),p(),s==null||s.$amapComponent.add(c),S(),{_destroyComponent:()=>{E(),s!=null&&s.isDestroy||(s==null||s.$amapComponent.remove(c),c.destroy()),a&&(a.destroy(),a=null)},setSource:f}}const T=R({name:"ElAmapLoca",inheritAttrs:!1,__name:"Loca",props:q({ambLight:{type:Object},dirLight:{type:Object},pointLight:{type:Object},onClick:{type:Function,default:null},onMousemove:{type:Function,default:null},onRightclick:{type:Function,default:null},eventOptions:{type:Object,default:()=>({hitFirst:!0})}}),emits:K,setup(n,{expose:i,emit:r}){const a=[],s={$amapComponent:void 0,addChildComponent(e){a.push(e)},isDestroy:!1,getMap:()=>g()};x(z,s);const c=n,l=r;let o,p=!1,f=!1,S=!0;const{$$getInstance:$,parentInstance:m}=J((e,u)=>new Promise(C=>{o=new Loca.Container({map:u}),s.$amapComponent=o,e.ambLight&&(o.ambLight=e.ambLight),e.dirLight&&(o.dirLight=e.dirLight),e.pointLight&&(o.pointLight=e.pointLight),S=e.eventOptions.hitFirst,M(),C(o)}),{emits:l,needInitComponents:a,provideData:s,destroyComponent(){o&&(d(),o.animate&&o.animate.stop&&o.animate.stop(),o.destroy(),o=null)}}),g=()=>m==null?void 0:m.$amapComponent,M=()=>{if(m){const e=g();c.onClick!==null&&e.on("click",y),c.onMousemove!==null&&(e.on("mousemove",k),e.on("dragstart",L),e.on("dragend",b),e.on("rotatestart",F),e.on("rotateend",t),e.on("mouseout",E)),c.onRightclick!==null&&e.on("rightclick",_)}},y=e=>{const u=h(e);l("click",u,e)},_=e=>{const u=h(e);l("rightclick",u,e)},k=e=>{if(p||f)return;const u=h(e);l("mousemove",u,e)},h=e=>{const u=[];if(o.layers){const C=[];o.layers.forEach(v=>{C.push(v)}),C.sort((v,B)=>B.zIndex-v.zIndex);const w=C.length;for(let v=0;v<w;v++){const B=C[v].queryFeature(e.pixel.toArray());if(B&&(u.push(B),S))break}}return u},L=()=>{p=!0},b=()=>{p=!1},E=()=>{p=!1,f=!1},F=()=>{f=!0},t=()=>{f=!1},d=()=>{if(m){const e=g();e.off("click",y),e.off("rightclick",_),e.off("mousemove",k),e.off("dragstart",L),e.off("dragend",b),e.off("rotatestart",F),e.off("rotateend",t),e.off("mouseout",E)}};i({$$getInstance:$});const j={needInitComponents:a,provideData:s,props:c,emits:l,get $amapComponent(){return o},set $amapComponent(e){o=e},get isDragging(){return p},set isDragging(e){p=e},get isRotating(){return f},set isRotating(e){f=e},get hitFirst(){return S},set hitFirst(e){S=e},$$getInstance:$,parentInstance:m,getMap:g,bindEvents:M,clickMap:y,rightclickMap:_,mouseMoveMap:k,_getFeature:h,dragStart:L,dragEnd:b,mouseoutMap:E,rotateStart:F,rotateEnd:t,unBindEvents:d};return Object.defineProperty(j,"__isScriptSetup",{enumerable:!1,value:!0}),j}});function V(n,i,r,a,s,c){return N(),G("div",null,[P(n.$slots,"default")])}const O=A(T,[["render",V],["__file","Loca.vue"]]);O.install=n=>(n.component(O.name,O),n);const Y=O;export{Y as E,X as a,q as b,K as c,Q as u};
