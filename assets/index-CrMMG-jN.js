import{D as ns,H as V,F as ce,a as ae,L as Ae,b as H,c as bt,C as is,d as Ce,e as rs,O as se,B as Ie,f as fe,M as Ct,S as je,U as os,V as k,W as as,g as Fe,h as K,i as F,j as It,P as Ft,k as Dt,l as ee,s as j,m as W,T as cs,n as ls,I as us,o as hs,p as ze,q as Pt,R as xe,r as ds,t as me,u as fs,v as De,w as ps,x as ms,y as gs,z as _s,A as Rs,E as Ts,G as ys,J as ge,K as we,N as Es,Q as Nt,X as As,Y as xs,Z as Pe,_ as q,$ as ws,a0 as Ot,a1 as Ls,a2 as Ss,a3 as vs,a4 as Ms,a5 as bs,a6 as Cs,a7 as Is,a8 as Fs,a9 as Ds,aa as Ke,ab as Ps,ac as Ns,ad as We,ae as Os,af as Gs,ag as U,ah as Hs,ai as Us,aj as Gt,ak as $e,al as Ve,am as Bs,an as ks,ao as js,ap as zs,aq as Ht,ar as Ks,as as Ws,at as $s}from"./three.module-BVXrWKE2.js";import{X as Le,aE as Vs,aF as Ne,N as pe,Y as Ut,U as Xs,A as Ys,aG as qs,G as Qs,a7 as Zs,aH as Bt,aI as Js,aJ as Xe,p as kt,ac as en,_ as jt,ad as tn,o as sn,c as nn}from"./app-BIv4BGsj.js";import{i as rn,W as Ye,a as on}from"./arrayEach-Bzrg1Ilf.js";import{b as zt,p as an,u as Kt}from"./index-XVBT3eyP.js";var cn=/\s/;function ln(o){for(var e=o.length;e--&&cn.test(o.charAt(e)););return e}var un=/^\s+/;function hn(o){return o&&o.slice(0,ln(o)+1).replace(un,"")}var qe=NaN,dn=/^[-+]0x[0-9a-f]+$/i,fn=/^0b[01]+$/i,pn=/^0o[0-7]+$/i,mn=parseInt;function gn(o){if(typeof o=="number")return o;if(rn(o))return qe;if(Le(o)){var e=typeof o.valueOf=="function"?o.valueOf():o;o=Le(e)?e+"":e}if(typeof o!="string")return o===0?o:+o;o=hn(o);var t=fn.test(o);return t||pn.test(o)?mn(o.slice(2),t?2:8):dn.test(o)?qe:+o}var Qe=1/0,_n=17976931348623157e292;function Rn(o){if(!o)return o===0?o:0;if(o=gn(o),o===Qe||o===-Qe){var e=o<0?-1:1;return e*_n}return o===o?o:0}function Ze(o){var e=Rn(o),t=e%1;return e===e?t?e-t:e:0}var he=Ye&&new Ye,Wt=he?function(o,e){return he.set(o,e),o}:Vs;function ne(o){return function(){var e=arguments;switch(e.length){case 0:return new o;case 1:return new o(e[0]);case 2:return new o(e[0],e[1]);case 3:return new o(e[0],e[1],e[2]);case 4:return new o(e[0],e[1],e[2],e[3]);case 5:return new o(e[0],e[1],e[2],e[3],e[4]);case 6:return new o(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new o(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var t=Ne(o.prototype),s=o.apply(t,e);return Le(s)?s:t}}var Tn=1;function yn(o,e,t){var s=e&Tn,n=ne(o);function i(){var r=this&&this!==pe&&this instanceof i?n:o;return r.apply(s?t:this,arguments)}return i}var En=Math.max;function $t(o,e,t,s){for(var n=-1,i=o.length,r=t.length,a=-1,c=e.length,l=En(i-r,0),h=Array(c+l),u=!s;++a<c;)h[a]=e[a];for(;++n<r;)(u||n<i)&&(h[t[n]]=o[n]);for(;l--;)h[a++]=o[n++];return h}var An=Math.max;function Vt(o,e,t,s){for(var n=-1,i=o.length,r=-1,a=t.length,c=-1,l=e.length,h=An(i-a,0),u=Array(h+l),f=!s;++n<h;)u[n]=o[n];for(var p=n;++c<l;)u[p+c]=e[c];for(;++r<a;)(f||n<i)&&(u[p+t[r]]=o[n++]);return u}function xn(o,e){for(var t=o.length,s=0;t--;)o[t]===e&&++s;return s}function Oe(){}var wn=4294967295;function X(o){this.__wrapped__=o,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=wn,this.__views__=[]}X.prototype=Ne(Oe.prototype);X.prototype.constructor=X;function Ln(){}var Xt=he?function(o){return he.get(o)}:Ln,Je={},Sn=Object.prototype,vn=Sn.hasOwnProperty;function Mn(o){for(var e=o.name+"",t=Je[e],s=vn.call(Je,e)?t.length:0;s--;){var n=t[s],i=n.func;if(i==null||i==o)return n.name}return e}function Y(o,e){this.__wrapped__=o,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}Y.prototype=Ne(Oe.prototype);Y.prototype.constructor=Y;function bn(o){if(o instanceof X)return o.clone();var e=new Y(o.__wrapped__,o.__chain__);return e.__actions__=Ut(o.__actions__),e.__index__=o.__index__,e.__values__=o.__values__,e}var Cn=Object.prototype,In=Cn.hasOwnProperty;function de(o){if(Xs(o)&&!Ys(o)&&!(o instanceof X)){if(o instanceof Y)return o;if(In.call(o,"__wrapped__"))return bn(o)}return new Y(o)}de.prototype=Oe.prototype;de.prototype.constructor=de;function Fn(o){var e=Mn(o),t=de[e];if(typeof t!="function"||!(e in X.prototype))return!1;if(o===t)return!0;var s=Xt(t);return!!s&&o===s[0]}var Yt=qs(Wt),Dn=/\{\n\/\* \[wrapped with (.+)\] \*/,Pn=/,? & /;function Nn(o){var e=o.match(Dn);return e?e[1].split(Pn):[]}var On=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/;function Gn(o,e){var t=e.length;if(!t)return o;var s=t-1;return e[s]=(t>1?"& ":"")+e[s],e=e.join(t>2?", ":" "),o.replace(On,`{
/* [wrapped with `+e+`] */
`)}function Hn(o,e,t,s){for(var n=o.length,i=t+-1;++i<n;)if(e(o[i],i,o))return i;return-1}function Un(o){return o!==o}function Bn(o,e,t){for(var s=t-1,n=o.length;++s<n;)if(o[s]===e)return s;return-1}function kn(o,e,t){return e===e?Bn(o,e,t):Hn(o,Un,t)}function jn(o,e){var t=o==null?0:o.length;return!!t&&kn(o,e,0)>-1}var zn=1,Kn=2,Wn=8,$n=16,Vn=32,Xn=64,Yn=128,qn=256,Qn=512,Zn=[["ary",Yn],["bind",zn],["bindKey",Kn],["curry",Wn],["curryRight",$n],["flip",Qn],["partial",Vn],["partialRight",Xn],["rearg",qn]];function Jn(o,e){return on(Zn,function(t){var s="_."+t[0];e&t[1]&&!jn(o,s)&&o.push(s)}),o.sort()}function qt(o,e,t){var s=e+"";return Qs(o,Gn(s,Jn(Nn(s),t)))}var ei=1,ti=2,si=4,ni=8,et=32,tt=64;function Qt(o,e,t,s,n,i,r,a,c,l){var h=e&ni,u=h?r:void 0,f=h?void 0:r,p=h?i:void 0,_=h?void 0:i;e|=h?et:tt,e&=~(h?tt:et),e&si||(e&=~(ei|ti));var m=[o,e,n,p,u,_,f,a,c,l],d=t.apply(void 0,m);return Fn(o)&&Yt(d,m),d.placeholder=s,qt(d,o,e)}function Ge(o){var e=o;return e.placeholder}var ii=Math.min;function ri(o,e){for(var t=o.length,s=ii(e.length,t),n=Ut(o);s--;){var i=e[s];o[s]=Zs(i,t)?n[i]:void 0}return o}var st="__lodash_placeholder__";function ie(o,e){for(var t=-1,s=o.length,n=0,i=[];++t<s;){var r=o[t];(r===e||r===st)&&(o[t]=st,i[n++]=t)}return i}var oi=1,ai=2,ci=8,li=16,ui=128,hi=512;function He(o,e,t,s,n,i,r,a,c,l){var h=e&ui,u=e&oi,f=e&ai,p=e&(ci|li),_=e&hi,m=f?void 0:ne(o);function d(){for(var R=arguments.length,y=Array(R),g=R;g--;)y[g]=arguments[g];if(p)var T=Ge(d),S=xn(y,T);if(s&&(y=$t(y,s,n,p)),i&&(y=Vt(y,i,r,p)),R-=S,p&&R<l){var x=ie(y,T);return Qt(o,e,He,d.placeholder,t,y,x,a,c,l-R)}var E=u?t:this,L=f?E[o]:o;return R=y.length,a?y=ri(y,a):_&&R>1&&y.reverse(),h&&c<R&&(y.length=c),this&&this!==pe&&this instanceof d&&(L=m||ne(L)),L.apply(E,y)}return d}function di(o,e,t){var s=ne(o);function n(){for(var i=arguments.length,r=Array(i),a=i,c=Ge(n);a--;)r[a]=arguments[a];var l=i<3&&r[0]!==c&&r[i-1]!==c?[]:ie(r,c);if(i-=l.length,i<t)return Qt(o,e,He,n.placeholder,void 0,r,l,void 0,void 0,t-i);var h=this&&this!==pe&&this instanceof n?s:o;return Bt(h,this,r)}return n}var fi=1;function pi(o,e,t,s){var n=e&fi,i=ne(o);function r(){for(var a=-1,c=arguments.length,l=-1,h=s.length,u=Array(h+c),f=this&&this!==pe&&this instanceof r?i:o;++l<h;)u[l]=s[l];for(;c--;)u[l++]=arguments[++a];return Bt(f,n?t:this,u)}return r}var nt="__lodash_placeholder__",_e=1,mi=2,gi=4,it=8,Q=128,rt=256,_i=Math.min;function Ri(o,e){var t=o[1],s=e[1],n=t|s,i=n<(_e|mi|Q),r=s==Q&&t==it||s==Q&&t==rt&&o[7].length<=e[8]||s==(Q|rt)&&e[7].length<=e[8]&&t==it;if(!(i||r))return o;s&_e&&(o[2]=e[2],n|=t&_e?0:gi);var a=e[3];if(a){var c=o[3];o[3]=c?$t(c,a,e[4]):a,o[4]=c?ie(o[3],nt):e[4]}return a=e[5],a&&(c=o[5],o[5]=c?Vt(c,a,e[6]):a,o[6]=c?ie(o[5],nt):e[6]),a=e[7],a&&(o[7]=a),s&Q&&(o[8]=o[8]==null?e[8]:_i(o[8],e[8])),o[9]==null&&(o[9]=e[9]),o[0]=e[0],o[1]=n,o}var Ti="Expected a function",ot=1,yi=2,Re=8,Te=16,ye=32,at=64,ct=Math.max;function Ei(o,e,t,s,n,i,r,a){var c=e&yi;if(!c&&typeof o!="function")throw new TypeError(Ti);var l=s?s.length:0;if(l||(e&=~(ye|at),s=n=void 0),r=r===void 0?r:ct(Ze(r),0),a=a===void 0?a:Ze(a),l-=n?n.length:0,e&at){var h=s,u=n;s=n=void 0}var f=c?void 0:Xt(o),p=[o,e,t,s,n,h,u,i,r,a];if(f&&Ri(p,f),o=p[0],e=p[1],t=p[2],s=p[3],n=p[4],a=p[9]=p[9]===void 0?c?0:o.length:ct(p[9]-l,0),!a&&e&(Re|Te)&&(e&=~(Re|Te)),!e||e==ot)var _=yn(o,e,t);else e==Re||e==Te?_=di(o,e,a):(e==ye||e==(ot|ye))&&!n.length?_=pi(o,e,t,s):_=He.apply(void 0,p);var m=f?Wt:Yt;return qt(m(_,p),o,e)}var Ai=1,xi=32,te=Js(function(o,e,t){var s=Ai;if(t.length){var n=ie(t,Ge(te));s|=xi}return Ei(o,s,e,t,n)});te.placeholder={};class wi extends ns{constructor(e){super(e),this.type=V}parse(e){const a=function(g,T){switch(g){case 1:console.error("THREE.RGBELoader Read Error: "+(T||""));break;case 2:console.error("THREE.RGBELoader Write Error: "+(T||""));break;case 3:console.error("THREE.RGBELoader Bad File Format: "+(T||""));break;default:case 4:console.error("THREE.RGBELoader: Error: "+(T||""))}return-1},u=`
`,f=function(g,T,S){T=T||1024;let E=g.pos,L=-1,A=0,M="",w=String.fromCharCode.apply(null,new Uint16Array(g.subarray(E,E+128)));for(;0>(L=w.indexOf(u))&&A<T&&E<g.byteLength;)M+=w,A+=w.length,E+=128,w+=String.fromCharCode.apply(null,new Uint16Array(g.subarray(E,E+128)));return-1<L?(g.pos+=A+L+1,M+w.slice(0,L)):!1},p=function(g){const T=/^#\?(\S+)/,S=/^\s*GAMMA\s*=\s*(\d+(\.\d+)?)\s*$/,x=/^\s*EXPOSURE\s*=\s*(\d+(\.\d+)?)\s*$/,E=/^\s*FORMAT=(\S+)\s*$/,L=/^\s*\-Y\s+(\d+)\s+\+X\s+(\d+)\s*$/,A={valid:0,string:"",comments:"",programtype:"RGBE",format:"",gamma:1,exposure:1,width:0,height:0};let M,w;if(g.pos>=g.byteLength||!(M=f(g)))return a(1,"no header found");if(!(w=M.match(T)))return a(3,"bad initial token");for(A.valid|=1,A.programtype=w[1],A.string+=M+`
`;M=f(g),M!==!1;){if(A.string+=M+`
`,M.charAt(0)==="#"){A.comments+=M+`
`;continue}if((w=M.match(S))&&(A.gamma=parseFloat(w[1])),(w=M.match(x))&&(A.exposure=parseFloat(w[1])),(w=M.match(E))&&(A.valid|=2,A.format=w[1]),(w=M.match(L))&&(A.valid|=4,A.height=parseInt(w[1],10),A.width=parseInt(w[2],10)),A.valid&2&&A.valid&4)break}return A.valid&2?A.valid&4?A:a(3,"missing image size specifier"):a(3,"missing format specifier")},_=function(g,T,S){const x=T;if(x<8||x>32767||g[0]!==2||g[1]!==2||g[2]&128)return new Uint8Array(g);if(x!==(g[2]<<8|g[3]))return a(3,"wrong scanline width");const E=new Uint8Array(4*T*S);if(!E.length)return a(4,"unable to allocate buffer space");let L=0,A=0;const M=4*x,w=new Uint8Array(4),C=new Uint8Array(M);let I=S;for(;I>0&&A<g.byteLength;){if(A+4>g.byteLength)return a(1);if(w[0]=g[A++],w[1]=g[A++],w[2]=g[A++],w[3]=g[A++],w[0]!=2||w[1]!=2||(w[2]<<8|w[3])!=x)return a(3,"bad rgbe scanline format");let N=0,b;for(;N<M&&A<g.byteLength;){b=g[A++];const D=b>128;if(D&&(b-=128),b===0||N+b>M)return a(3,"bad scanline data");if(D){const P=g[A++];for(let ke=0;ke<b;ke++)C[N++]=P}else C.set(g.subarray(A,A+b),N),N+=b,A+=b}const oe=x;for(let D=0;D<oe;D++){let P=0;E[L]=C[D+P],P+=x,E[L+1]=C[D+P],P+=x,E[L+2]=C[D+P],P+=x,E[L+3]=C[D+P],L+=4}I--}return E},m=function(g,T,S,x){const E=g[T+3],L=Math.pow(2,E-128)/255;S[x+0]=g[T+0]*L,S[x+1]=g[T+1]*L,S[x+2]=g[T+2]*L,S[x+3]=1},d=function(g,T,S,x){const E=g[T+3],L=Math.pow(2,E-128)/255;S[x+0]=ae.toHalfFloat(Math.min(g[T+0]*L,65504)),S[x+1]=ae.toHalfFloat(Math.min(g[T+1]*L,65504)),S[x+2]=ae.toHalfFloat(Math.min(g[T+2]*L,65504)),S[x+3]=ae.toHalfFloat(1)},R=new Uint8Array(e);R.pos=0;const y=p(R);if(y!==-1){const g=y.width,T=y.height,S=_(R.subarray(R.pos),g,T);if(S!==-1){let x,E,L;switch(this.type){case ce:L=S.length/4;const A=new Float32Array(L*4);for(let w=0;w<L;w++)m(S,w*4,A,w*4);x=A,E=ce;break;case V:L=S.length/4;const M=new Uint16Array(L*4);for(let w=0;w<L;w++)d(S,w*4,M,w*4);x=M,E=V;break;default:console.error("THREE.RGBELoader: unsupported type: ",this.type);break}return{width:g,height:T,data:x,header:y.string,gamma:y.gamma,exposure:y.exposure,type:E}}}return null}setDataType(e){return this.type=e,this}load(e,t,s,n){function i(r,a){switch(r.type){case ce:case V:r.encoding=Ae,r.minFilter=H,r.magFilter=H,r.generateMipmaps=!1,r.flipY=!0;break}t&&t(r,a)}return super.load(e,i,s,n)}}class Li extends bt{constructor(e){super(e),this.hdrLoader=new wi,this.type=V}load(e,t,s,n){Array.isArray(e)||(console.warn("THREE.HDRCubeTextureLoader signature has changed. Use .setDataType() instead."),this.setDataType(e),e=t,t=s,s=n,n=arguments[4]);const i=new is;switch(i.type=this.type,i.type){case ce:i.encoding=Ae,i.minFilter=H,i.magFilter=H,i.generateMipmaps=!1;break;case V:i.encoding=Ae,i.minFilter=H,i.magFilter=H,i.generateMipmaps=!1;break}const r=this;let a=0;function c(l,h,u,f){new Ce(r.manager).setPath(r.path).setResponseType("arraybuffer").setWithCredentials(r.withCredentials).load(e[l],function(p){a++;const _=r.hdrLoader.parse(p);if(_){if(_.data!==void 0){const m=new rs(_.data,_.width,_.height);m.type=i.type,m.encoding=i.encoding,m.format=i.format,m.minFilter=i.minFilter,m.magFilter=i.magFilter,m.generateMipmaps=i.generateMipmaps,i.images[l]=m}a===6&&(i.needsUpdate=!0,h&&h(i))}},u,f)}for(let l=0;l<e.length;l++)c(l,t,s,n);return i}setDataType(e){return this.type=e,this.hdrLoader.setDataType(e),this}}const lt={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:`

		varying vec2 vUv;

		void main() {

			vUv = uv;
			gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );

		}`,fragmentShader:`

		uniform float opacity;

		uniform sampler2D tDiffuse;

		varying vec2 vUv;

		void main() {

			gl_FragColor = texture2D( tDiffuse, vUv );
			gl_FragColor.a *= opacity;


		}`};class Ue{constructor(){this.enabled=!0,this.needsSwap=!0,this.clear=!1,this.renderToScreen=!1}setSize(){}render(){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}const Si=new se(-1,1,1,-1,0,1),Be=new Ie;Be.setAttribute("position",new fe([-1,3,0,-1,-1,0,3,-1,0],3));Be.setAttribute("uv",new fe([0,2,0,0,2,0],2));class vi{constructor(e){this._mesh=new Ct(Be,e)}dispose(){this._mesh.geometry.dispose()}render(e){e.render(this._mesh,Si)}get material(){return this._mesh.material}set material(e){this._mesh.material=e}}class ut extends Ue{constructor(e,t){super(),this.textureID=t!==void 0?t:"tDiffuse",e instanceof je?(this.uniforms=e.uniforms,this.material=e):e&&(this.uniforms=os.clone(e.uniforms),this.material=new je({defines:Object.assign({},e.defines),uniforms:this.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),this.fsQuad=new vi(this.material)}render(e,t,s){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=s.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}class ht extends Ue{constructor(e,t){super(),this.scene=e,this.camera=t,this.clear=!0,this.needsSwap=!1,this.inverse=!1}render(e,t,s){const n=e.getContext(),i=e.state;i.buffers.color.setMask(!1),i.buffers.depth.setMask(!1),i.buffers.color.setLocked(!0),i.buffers.depth.setLocked(!0);let r,a;this.inverse?(r=0,a=1):(r=1,a=0),i.buffers.stencil.setTest(!0),i.buffers.stencil.setOp(n.REPLACE,n.REPLACE,n.REPLACE),i.buffers.stencil.setFunc(n.ALWAYS,r,4294967295),i.buffers.stencil.setClear(a),i.buffers.stencil.setLocked(!0),e.setRenderTarget(s),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),i.buffers.color.setLocked(!1),i.buffers.depth.setLocked(!1),i.buffers.stencil.setLocked(!1),i.buffers.stencil.setFunc(n.EQUAL,1,4294967295),i.buffers.stencil.setOp(n.KEEP,n.KEEP,n.KEEP),i.buffers.stencil.setLocked(!0)}}class Mi extends Ue{constructor(){super(),this.needsSwap=!1}render(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}class bi{constructor(e,t){if(this.renderer=e,t===void 0){const s=e.getSize(new k);this._pixelRatio=e.getPixelRatio(),this._width=s.width,this._height=s.height,t=new as(this._width*this._pixelRatio,this._height*this._pixelRatio),t.texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=t.width,this._height=t.height;this.renderTarget1=t,this.renderTarget2=t.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,this.passes=[],lt===void 0&&console.error("THREE.EffectComposer relies on CopyShader"),ut===void 0&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new ut(lt),this.clock=new Fe}swapBuffers(){const e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}addPass(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}insertPass(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}removePass(e){const t=this.passes.indexOf(e);t!==-1&&this.passes.splice(t,1)}isLastEnabledPass(e){for(let t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}render(e){e===void 0&&(e=this.clock.getDelta());const t=this.renderer.getRenderTarget();let s=!1;for(let n=0,i=this.passes.length;n<i;n++){const r=this.passes[n];if(r.enabled!==!1){if(r.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(n),r.render(this.renderer,this.writeBuffer,this.readBuffer,e,s),r.needsSwap){if(s){const a=this.renderer.getContext(),c=this.renderer.state.buffers.stencil;c.setFunc(a.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),c.setFunc(a.EQUAL,1,4294967295)}this.swapBuffers()}ht!==void 0&&(r instanceof ht?s=!0:r instanceof Mi&&(s=!1))}}this.renderer.setRenderTarget(t)}reset(e){if(e===void 0){const t=this.renderer.getSize(new k);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,e=this.renderTarget1.clone(),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}setSize(e,t){this._width=e,this._height=t;const s=this._width*this._pixelRatio,n=this._height*this._pixelRatio;this.renderTarget1.setSize(s,n),this.renderTarget2.setSize(s,n);for(let i=0;i<this.passes.length;i++)this.passes[i].setSize(s,n)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}new se(-1,1,1,-1,0,1);const Zt=new Ie;Zt.setAttribute("position",new fe([-1,3,0,-1,-1,0,3,-1,0],3));Zt.setAttribute("uv",new fe([0,2,0,0,2,0],2));class dt extends bt{constructor(e){super(e),this.dracoLoader=null,this.ktx2Loader=null,this.meshoptDecoder=null,this.pluginCallbacks=[],this.register(function(t){return new Pi(t)}),this.register(function(t){return new ki(t)}),this.register(function(t){return new ji(t)}),this.register(function(t){return new Oi(t)}),this.register(function(t){return new Gi(t)}),this.register(function(t){return new Hi(t)}),this.register(function(t){return new Ui(t)}),this.register(function(t){return new Di(t)}),this.register(function(t){return new Bi(t)}),this.register(function(t){return new Ni(t)}),this.register(function(t){return new Ii(t)}),this.register(function(t){return new zi(t)})}load(e,t,s,n){const i=this;let r;this.resourcePath!==""?r=this.resourcePath:this.path!==""?r=this.path:r=K.extractUrlBase(e),this.manager.itemStart(e);const a=function(l){n?n(l):console.error(l),i.manager.itemError(e),i.manager.itemEnd(e)},c=new Ce(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(this.withCredentials),c.load(e,function(l){try{i.parse(l,r,function(h){t(h),i.manager.itemEnd(e)},a)}catch(h){a(h)}},s,a)}setDRACOLoader(e){return this.dracoLoader=e,this}setDDSLoader(){throw new Error('THREE.GLTFLoader: "MSFT_texture_dds" no longer supported. Please update to "KHR_texture_basisu".')}setKTX2Loader(e){return this.ktx2Loader=e,this}setMeshoptDecoder(e){return this.meshoptDecoder=e,this}register(e){return this.pluginCallbacks.indexOf(e)===-1&&this.pluginCallbacks.push(e),this}unregister(e){return this.pluginCallbacks.indexOf(e)!==-1&&this.pluginCallbacks.splice(this.pluginCallbacks.indexOf(e),1),this}parse(e,t,s,n){let i;const r={},a={};if(typeof e=="string")i=e;else if(K.decodeText(new Uint8Array(e,0,4))===Jt){try{r[v.KHR_BINARY_GLTF]=new Ki(e)}catch(u){n&&n(u);return}i=r[v.KHR_BINARY_GLTF].content}else i=K.decodeText(new Uint8Array(e));const c=JSON.parse(i);if(c.asset===void 0||c.asset.version[0]<2){n&&n(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported."));return}const l=new nr(c,{path:t||this.resourcePath||"",crossOrigin:this.crossOrigin,requestHeader:this.requestHeader,manager:this.manager,ktx2Loader:this.ktx2Loader,meshoptDecoder:this.meshoptDecoder});l.fileLoader.setRequestHeader(this.requestHeader);for(let h=0;h<this.pluginCallbacks.length;h++){const u=this.pluginCallbacks[h](l);a[u.name]=u,r[u.name]=!0}if(c.extensionsUsed)for(let h=0;h<c.extensionsUsed.length;++h){const u=c.extensionsUsed[h],f=c.extensionsRequired||[];switch(u){case v.KHR_MATERIALS_UNLIT:r[u]=new Fi;break;case v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:r[u]=new Vi;break;case v.KHR_DRACO_MESH_COMPRESSION:r[u]=new Wi(c,this.dracoLoader);break;case v.KHR_TEXTURE_TRANSFORM:r[u]=new $i;break;case v.KHR_MESH_QUANTIZATION:r[u]=new Xi;break;default:f.indexOf(u)>=0&&a[u]===void 0&&console.warn('THREE.GLTFLoader: Unknown extension "'+u+'".')}}l.setExtensions(r),l.setPlugins(a),l.parse(s,n)}parseAsync(e,t){const s=this;return new Promise(function(n,i){s.parse(e,t,n,i)})}}function Ci(){let o={};return{get:function(e){return o[e]},add:function(e,t){o[e]=t},remove:function(e){delete o[e]},removeAll:function(){o={}}}}const v={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_DRACO_MESH_COMPRESSION:"KHR_draco_mesh_compression",KHR_LIGHTS_PUNCTUAL:"KHR_lights_punctual",KHR_MATERIALS_CLEARCOAT:"KHR_materials_clearcoat",KHR_MATERIALS_IOR:"KHR_materials_ior",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness",KHR_MATERIALS_SHEEN:"KHR_materials_sheen",KHR_MATERIALS_SPECULAR:"KHR_materials_specular",KHR_MATERIALS_TRANSMISSION:"KHR_materials_transmission",KHR_MATERIALS_IRIDESCENCE:"KHR_materials_iridescence",KHR_MATERIALS_UNLIT:"KHR_materials_unlit",KHR_MATERIALS_VOLUME:"KHR_materials_volume",KHR_TEXTURE_BASISU:"KHR_texture_basisu",KHR_TEXTURE_TRANSFORM:"KHR_texture_transform",KHR_MESH_QUANTIZATION:"KHR_mesh_quantization",KHR_MATERIALS_EMISSIVE_STRENGTH:"KHR_materials_emissive_strength",EXT_TEXTURE_WEBP:"EXT_texture_webp",EXT_MESHOPT_COMPRESSION:"EXT_meshopt_compression"};class Ii{constructor(e){this.parser=e,this.name=v.KHR_LIGHTS_PUNCTUAL,this.cache={refs:{},uses:{}}}_markDefs(){const e=this.parser,t=this.parser.json.nodes||[];for(let s=0,n=t.length;s<n;s++){const i=t[s];i.extensions&&i.extensions[this.name]&&i.extensions[this.name].light!==void 0&&e._addNodeRef(this.cache,i.extensions[this.name].light)}}_loadLight(e){const t=this.parser,s="light:"+e;let n=t.cache.get(s);if(n)return n;const i=t.json,c=((i.extensions&&i.extensions[this.name]||{}).lights||[])[e];let l;const h=new F(16777215);c.color!==void 0&&h.fromArray(c.color);const u=c.range!==void 0?c.range:0;switch(c.type){case"directional":l=new Dt(h),l.target.position.set(0,0,-1),l.add(l.target);break;case"point":l=new Ft(h),l.distance=u;break;case"spot":l=new It(h),l.distance=u,c.spot=c.spot||{},c.spot.innerConeAngle=c.spot.innerConeAngle!==void 0?c.spot.innerConeAngle:0,c.spot.outerConeAngle=c.spot.outerConeAngle!==void 0?c.spot.outerConeAngle:Math.PI/4,l.angle=c.spot.outerConeAngle,l.penumbra=1-c.spot.innerConeAngle/c.spot.outerConeAngle,l.target.position.set(0,0,-1),l.add(l.target);break;default:throw new Error("THREE.GLTFLoader: Unexpected light type: "+c.type)}return l.position.set(0,0,0),l.decay=2,c.intensity!==void 0&&(l.intensity=c.intensity),l.name=t.createUniqueName(c.name||"light_"+e),n=Promise.resolve(l),t.cache.add(s,n),n}createNodeAttachment(e){const t=this,s=this.parser,i=s.json.nodes[e],a=(i.extensions&&i.extensions[this.name]||{}).light;return a===void 0?null:this._loadLight(a).then(function(c){return s._getNodeRef(t.cache,a,c)})}}class Fi{constructor(){this.name=v.KHR_MATERIALS_UNLIT}getMaterialType(){return ee}extendParams(e,t,s){const n=[];e.color=new F(1,1,1),e.opacity=1;const i=t.pbrMetallicRoughness;if(i){if(Array.isArray(i.baseColorFactor)){const r=i.baseColorFactor;e.color.fromArray(r),e.opacity=r[3]}i.baseColorTexture!==void 0&&n.push(s.assignTexture(e,"map",i.baseColorTexture,j))}return Promise.all(n)}}class Di{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_EMISSIVE_STRENGTH}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name].emissiveStrength;return i!==void 0&&(t.emissiveIntensity=i),Promise.resolve()}}class Pi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_CLEARCOAT}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];if(r.clearcoatFactor!==void 0&&(t.clearcoat=r.clearcoatFactor),r.clearcoatTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatMap",r.clearcoatTexture)),r.clearcoatRoughnessFactor!==void 0&&(t.clearcoatRoughness=r.clearcoatRoughnessFactor),r.clearcoatRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"clearcoatRoughnessMap",r.clearcoatRoughnessTexture)),r.clearcoatNormalTexture!==void 0&&(i.push(s.assignTexture(t,"clearcoatNormalMap",r.clearcoatNormalTexture)),r.clearcoatNormalTexture.scale!==void 0)){const a=r.clearcoatNormalTexture.scale;t.clearcoatNormalScale=new k(a,a)}return Promise.all(i)}}class Ni{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IRIDESCENCE}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.iridescenceFactor!==void 0&&(t.iridescence=r.iridescenceFactor),r.iridescenceTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceMap",r.iridescenceTexture)),r.iridescenceIor!==void 0&&(t.iridescenceIOR=r.iridescenceIor),t.iridescenceThicknessRange===void 0&&(t.iridescenceThicknessRange=[100,400]),r.iridescenceThicknessMinimum!==void 0&&(t.iridescenceThicknessRange[0]=r.iridescenceThicknessMinimum),r.iridescenceThicknessMaximum!==void 0&&(t.iridescenceThicknessRange[1]=r.iridescenceThicknessMaximum),r.iridescenceThicknessTexture!==void 0&&i.push(s.assignTexture(t,"iridescenceThicknessMap",r.iridescenceThicknessTexture)),Promise.all(i)}}class Oi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SHEEN}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[];t.sheenColor=new F(0,0,0),t.sheenRoughness=0,t.sheen=1;const r=n.extensions[this.name];return r.sheenColorFactor!==void 0&&t.sheenColor.fromArray(r.sheenColorFactor),r.sheenRoughnessFactor!==void 0&&(t.sheenRoughness=r.sheenRoughnessFactor),r.sheenColorTexture!==void 0&&i.push(s.assignTexture(t,"sheenColorMap",r.sheenColorTexture,j)),r.sheenRoughnessTexture!==void 0&&i.push(s.assignTexture(t,"sheenRoughnessMap",r.sheenRoughnessTexture)),Promise.all(i)}}class Gi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_TRANSMISSION}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];return r.transmissionFactor!==void 0&&(t.transmission=r.transmissionFactor),r.transmissionTexture!==void 0&&i.push(s.assignTexture(t,"transmissionMap",r.transmissionTexture)),Promise.all(i)}}class Hi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_VOLUME}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.thickness=r.thicknessFactor!==void 0?r.thicknessFactor:0,r.thicknessTexture!==void 0&&i.push(s.assignTexture(t,"thicknessMap",r.thicknessTexture)),t.attenuationDistance=r.attenuationDistance||0;const a=r.attenuationColor||[1,1,1];return t.attenuationColor=new F(a[0],a[1],a[2]),Promise.all(i)}}class Ui{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_IOR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const n=this.parser.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=n.extensions[this.name];return t.ior=i.ior!==void 0?i.ior:1.5,Promise.resolve()}}class Bi{constructor(e){this.parser=e,this.name=v.KHR_MATERIALS_SPECULAR}getMaterialType(e){const s=this.parser.json.materials[e];return!s.extensions||!s.extensions[this.name]?null:W}extendMaterialParams(e,t){const s=this.parser,n=s.json.materials[e];if(!n.extensions||!n.extensions[this.name])return Promise.resolve();const i=[],r=n.extensions[this.name];t.specularIntensity=r.specularFactor!==void 0?r.specularFactor:1,r.specularTexture!==void 0&&i.push(s.assignTexture(t,"specularIntensityMap",r.specularTexture));const a=r.specularColorFactor||[1,1,1];return t.specularColor=new F(a[0],a[1],a[2]),r.specularColorTexture!==void 0&&i.push(s.assignTexture(t,"specularColorMap",r.specularColorTexture,j)),Promise.all(i)}}class ki{constructor(e){this.parser=e,this.name=v.KHR_TEXTURE_BASISU}loadTexture(e){const t=this.parser,s=t.json,n=s.textures[e];if(!n.extensions||!n.extensions[this.name])return null;const i=n.extensions[this.name],r=t.options.ktx2Loader;if(!r){if(s.extensionsRequired&&s.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures");return null}return t.loadTextureImage(e,i.source,r)}}class ji{constructor(e){this.parser=e,this.name=v.EXT_TEXTURE_WEBP,this.isSupported=null}loadTexture(e){const t=this.name,s=this.parser,n=s.json,i=n.textures[e];if(!i.extensions||!i.extensions[t])return null;const r=i.extensions[t],a=n.images[r.source];let c=s.textureLoader;if(a.uri){const l=s.options.manager.getHandler(a.uri);l!==null&&(c=l)}return this.detectSupport().then(function(l){if(l)return s.loadTextureImage(e,r.source,c);if(n.extensionsRequired&&n.extensionsRequired.indexOf(t)>=0)throw new Error("THREE.GLTFLoader: WebP required by asset but unsupported.");return s.loadTexture(e)})}detectSupport(){return this.isSupported||(this.isSupported=new Promise(function(e){const t=new Image;t.src="data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",t.onload=t.onerror=function(){e(t.height===1)}})),this.isSupported}}class zi{constructor(e){this.name=v.EXT_MESHOPT_COMPRESSION,this.parser=e}loadBufferView(e){const t=this.parser.json,s=t.bufferViews[e];if(s.extensions&&s.extensions[this.name]){const n=s.extensions[this.name],i=this.parser.getDependency("buffer",n.buffer),r=this.parser.options.meshoptDecoder;if(!r||!r.supported){if(t.extensionsRequired&&t.extensionsRequired.indexOf(this.name)>=0)throw new Error("THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files");return null}return Promise.all([i,r.ready]).then(function(a){const c=n.byteOffset||0,l=n.byteLength||0,h=n.count,u=n.byteStride,f=new ArrayBuffer(h*u),p=new Uint8Array(a[0],c,l);return r.decodeGltfBuffer(new Uint8Array(f),h,u,p,n.mode,n.filter),f})}else return null}}const Jt="glTF",Z=12,ft={JSON:1313821514,BIN:5130562};class Ki{constructor(e){this.name=v.KHR_BINARY_GLTF,this.content=null,this.body=null;const t=new DataView(e,0,Z);if(this.header={magic:K.decodeText(new Uint8Array(e.slice(0,4))),version:t.getUint32(4,!0),length:t.getUint32(8,!0)},this.header.magic!==Jt)throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.");if(this.header.version<2)throw new Error("THREE.GLTFLoader: Legacy binary file detected.");const s=this.header.length-Z,n=new DataView(e,Z);let i=0;for(;i<s;){const r=n.getUint32(i,!0);i+=4;const a=n.getUint32(i,!0);if(i+=4,a===ft.JSON){const c=new Uint8Array(e,Z+i,r);this.content=K.decodeText(c)}else if(a===ft.BIN){const c=Z+i;this.body=e.slice(c,c+r)}i+=r}if(this.content===null)throw new Error("THREE.GLTFLoader: JSON content not found.")}}class Wi{constructor(e,t){if(!t)throw new Error("THREE.GLTFLoader: No DRACOLoader instance provided.");this.name=v.KHR_DRACO_MESH_COMPRESSION,this.json=e,this.dracoLoader=t,this.dracoLoader.preload()}decodePrimitive(e,t){const s=this.json,n=this.dracoLoader,i=e.extensions[this.name].bufferView,r=e.extensions[this.name].attributes,a={},c={},l={};for(const h in r){const u=ve[h]||h.toLowerCase();a[u]=r[h]}for(const h in e.attributes){const u=ve[h]||h.toLowerCase();if(r[h]!==void 0){const f=s.accessors[e.attributes[h]],p=re[f.componentType];l[u]=p,c[u]=f.normalized===!0}}return t.getDependency("bufferView",i).then(function(h){return new Promise(function(u){n.decodeDracoFile(h,function(f){for(const p in f.attributes){const _=f.attributes[p],m=c[p];m!==void 0&&(_.normalized=m)}u(f)},a,l)})})}}class $i{constructor(){this.name=v.KHR_TEXTURE_TRANSFORM}extendTexture(e,t){return t.texCoord!==void 0&&console.warn('THREE.GLTFLoader: Custom UV sets in "'+this.name+'" extension not yet supported.'),t.offset===void 0&&t.rotation===void 0&&t.scale===void 0||(e=e.clone(),t.offset!==void 0&&e.offset.fromArray(t.offset),t.rotation!==void 0&&(e.rotation=t.rotation),t.scale!==void 0&&e.repeat.fromArray(t.scale),e.needsUpdate=!0),e}}class Se extends De{constructor(e){super(),this.isGLTFSpecularGlossinessMaterial=!0;const t=["#ifdef USE_SPECULARMAP","	uniform sampler2D specularMap;","#endif"].join(`
`),s=["#ifdef USE_GLOSSINESSMAP","	uniform sampler2D glossinessMap;","#endif"].join(`
`),n=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","	vec4 texelSpecular = texture2D( specularMap, vUv );","	// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","	specularFactor *= texelSpecular.rgb;","#endif"].join(`
`),i=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","	vec4 texelGlossiness = texture2D( glossinessMap, vUv );","	// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","	glossinessFactor *= texelGlossiness.a;","#endif"].join(`
`),r=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb * ( 1. - max( specularFactor.r, max( specularFactor.g, specularFactor.b ) ) );","vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );","float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );","material.roughness = max( 1.0 - glossinessFactor, 0.0525 ); // 0.0525 corresponds to the base mip of a 256 cubemap.","material.roughness += geometryRoughness;","material.roughness = min( material.roughness, 1.0 );","material.specularColor = specularFactor;"].join(`
`),a={specular:{value:new F().setHex(16777215)},glossiness:{value:1},specularMap:{value:null},glossinessMap:{value:null}};this._extraUniforms=a,this.onBeforeCompile=function(c){for(const l in a)c.uniforms[l]=a[l];c.fragmentShader=c.fragmentShader.replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",t).replace("#include <metalnessmap_pars_fragment>",s).replace("#include <roughnessmap_fragment>",n).replace("#include <metalnessmap_fragment>",i).replace("#include <lights_physical_fragment>",r)},Object.defineProperties(this,{specular:{get:function(){return a.specular.value},set:function(c){a.specular.value=c}},specularMap:{get:function(){return a.specularMap.value},set:function(c){a.specularMap.value=c,c?this.defines.USE_SPECULARMAP="":delete this.defines.USE_SPECULARMAP}},glossiness:{get:function(){return a.glossiness.value},set:function(c){a.glossiness.value=c}},glossinessMap:{get:function(){return a.glossinessMap.value},set:function(c){a.glossinessMap.value=c,c?(this.defines.USE_GLOSSINESSMAP="",this.defines.USE_UV=""):(delete this.defines.USE_GLOSSINESSMAP,delete this.defines.USE_UV)}}}),delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this.setValues(e)}copy(e){return super.copy(e),this.specularMap=e.specularMap,this.specular.copy(e.specular),this.glossinessMap=e.glossinessMap,this.glossiness=e.glossiness,delete this.metalness,delete this.roughness,delete this.metalnessMap,delete this.roughnessMap,this}}class Vi{constructor(){this.name=v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,this.specularGlossinessParams=["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","normalMapType","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity"]}getMaterialType(){return Se}extendParams(e,t,s){const n=t.extensions[this.name];e.color=new F(1,1,1),e.opacity=1;const i=[];if(Array.isArray(n.diffuseFactor)){const r=n.diffuseFactor;e.color.fromArray(r),e.opacity=r[3]}if(n.diffuseTexture!==void 0&&i.push(s.assignTexture(e,"map",n.diffuseTexture,j)),e.emissive=new F(0,0,0),e.glossiness=n.glossinessFactor!==void 0?n.glossinessFactor:1,e.specular=new F(1,1,1),Array.isArray(n.specularFactor)&&e.specular.fromArray(n.specularFactor),n.specularGlossinessTexture!==void 0){const r=n.specularGlossinessTexture;i.push(s.assignTexture(e,"glossinessMap",r)),i.push(s.assignTexture(e,"specularMap",r,j))}return Promise.all(i)}createMaterial(e){const t=new Se(e);return t.fog=!0,t.color=e.color,t.map=e.map===void 0?null:e.map,t.lightMap=null,t.lightMapIntensity=1,t.aoMap=e.aoMap===void 0?null:e.aoMap,t.aoMapIntensity=1,t.emissive=e.emissive,t.emissiveIntensity=e.emissiveIntensity===void 0?1:e.emissiveIntensity,t.emissiveMap=e.emissiveMap===void 0?null:e.emissiveMap,t.bumpMap=e.bumpMap===void 0?null:e.bumpMap,t.bumpScale=1,t.normalMap=e.normalMap===void 0?null:e.normalMap,t.normalMapType=cs,e.normalScale&&(t.normalScale=e.normalScale),t.displacementMap=null,t.displacementScale=1,t.displacementBias=0,t.specularMap=e.specularMap===void 0?null:e.specularMap,t.specular=e.specular,t.glossinessMap=e.glossinessMap===void 0?null:e.glossinessMap,t.glossiness=e.glossiness,t.alphaMap=null,t.envMap=e.envMap===void 0?null:e.envMap,t.envMapIntensity=1,t}}class Xi{constructor(){this.name=v.KHR_MESH_QUANTIZATION}}class es extends Us{constructor(e,t,s,n){super(e,t,s,n)}copySampleValue_(e){const t=this.resultBuffer,s=this.sampleValues,n=this.valueSize,i=e*n*3+n;for(let r=0;r!==n;r++)t[r]=s[i+r];return t}interpolate_(e,t,s,n){const i=this.resultBuffer,r=this.sampleValues,a=this.valueSize,c=a*2,l=a*3,h=n-t,u=(s-t)/h,f=u*u,p=f*u,_=e*l,m=_-l,d=-2*p+3*f,R=p-f,y=1-d,g=R-f+u;for(let T=0;T!==a;T++){const S=r[m+T+a],x=r[m+T+c]*h,E=r[_+T+a],L=r[_+T]*h;i[T]=y*S+g*x+d*E+R*L}return i}}const Yi=new Gt;class qi extends es{interpolate_(e,t,s,n){const i=super.interpolate_(e,t,s,n);return Yi.fromArray(i).normalize().toArray(i),i}}const G={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},re={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pt={9728:Ls,9729:H,9984:Ss,9985:vs,9986:Ms,9987:Pt},mt={33071:bs,33648:Cs,10497:xe},gt={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ve={POSITION:"position",NORMAL:"normal",TANGENT:"tangent",TEXCOORD_0:"uv",TEXCOORD_1:"uv2",COLOR_0:"color",WEIGHTS_0:"skinWeight",JOINTS_0:"skinIndex"},B={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},Qi={CUBICSPLINE:void 0,LINEAR:Nt,STEP:Is},Ee={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function Zi(o){return o.DefaultMaterial===void 0&&(o.DefaultMaterial=new De({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:Fs})),o.DefaultMaterial}function J(o,e,t){for(const s in t.extensions)o[s]===void 0&&(e.userData.gltfExtensions=e.userData.gltfExtensions||{},e.userData.gltfExtensions[s]=t.extensions[s])}function z(o,e){e.extras!==void 0&&(typeof e.extras=="object"?Object.assign(o.userData,e.extras):console.warn("THREE.GLTFLoader: Ignoring primitive type .extras, "+e.extras))}function Ji(o,e,t){let s=!1,n=!1,i=!1;for(let l=0,h=e.length;l<h;l++){const u=e[l];if(u.POSITION!==void 0&&(s=!0),u.NORMAL!==void 0&&(n=!0),u.COLOR_0!==void 0&&(i=!0),s&&n&&i)break}if(!s&&!n&&!i)return Promise.resolve(o);const r=[],a=[],c=[];for(let l=0,h=e.length;l<h;l++){const u=e[l];if(s){const f=u.POSITION!==void 0?t.getDependency("accessor",u.POSITION):o.attributes.position;r.push(f)}if(n){const f=u.NORMAL!==void 0?t.getDependency("accessor",u.NORMAL):o.attributes.normal;a.push(f)}if(i){const f=u.COLOR_0!==void 0?t.getDependency("accessor",u.COLOR_0):o.attributes.color;c.push(f)}}return Promise.all([Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2];return s&&(o.morphAttributes.position=h),n&&(o.morphAttributes.normal=u),i&&(o.morphAttributes.color=f),o.morphTargetsRelative=!0,o})}function er(o,e){if(o.updateMorphTargets(),e.weights!==void 0)for(let t=0,s=e.weights.length;t<s;t++)o.morphTargetInfluences[t]=e.weights[t];if(e.extras&&Array.isArray(e.extras.targetNames)){const t=e.extras.targetNames;if(o.morphTargetInfluences.length===t.length){o.morphTargetDictionary={};for(let s=0,n=t.length;s<n;s++)o.morphTargetDictionary[t[s]]=s}else console.warn("THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.")}}function tr(o){const e=o.extensions&&o.extensions[v.KHR_DRACO_MESH_COMPRESSION];let t;return e?t="draco:"+e.bufferView+":"+e.indices+":"+_t(e.attributes):t=o.indices+":"+_t(o.attributes)+":"+o.mode,t}function _t(o){let e="";const t=Object.keys(o).sort();for(let s=0,n=t.length;s<n;s++)e+=t[s]+":"+o[t[s]]+";";return e}function Me(o){switch(o){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:throw new Error("THREE.GLTFLoader: Unsupported normalized accessor component type.")}}function sr(o){return o.search(/\.jpe?g($|\?)/i)>0||o.search(/^data\:image\/jpeg/)===0?"image/jpeg":o.search(/\.webp($|\?)/i)>0||o.search(/^data\:image\/webp/)===0?"image/webp":"image/png"}class nr{constructor(e={},t={}){this.json=e,this.extensions={},this.plugins={},this.options=t,this.cache=new Ci,this.associations=new Map,this.primitiveCache={},this.meshCache={refs:{},uses:{}},this.cameraCache={refs:{},uses:{}},this.lightCache={refs:{},uses:{}},this.sourceCache={},this.textureCache={},this.nodeNamesUsed={};const s=/^((?!chrome|android).)*safari/i.test(navigator.userAgent)===!0,n=navigator.userAgent.indexOf("Firefox")>-1,i=n?navigator.userAgent.match(/Firefox\/([0-9]+)\./)[1]:-1;typeof createImageBitmap>"u"||s||n&&i<98?this.textureLoader=new ls(this.options.manager):this.textureLoader=new us(this.options.manager),this.textureLoader.setCrossOrigin(this.options.crossOrigin),this.textureLoader.setRequestHeader(this.options.requestHeader),this.fileLoader=new Ce(this.options.manager),this.fileLoader.setResponseType("arraybuffer"),this.options.crossOrigin==="use-credentials"&&this.fileLoader.setWithCredentials(!0)}setExtensions(e){this.extensions=e}setPlugins(e){this.plugins=e}parse(e,t){const s=this,n=this.json,i=this.extensions;this.cache.removeAll(),this._invokeAll(function(r){return r._markDefs&&r._markDefs()}),Promise.all(this._invokeAll(function(r){return r.beforeRoot&&r.beforeRoot()})).then(function(){return Promise.all([s.getDependencies("scene"),s.getDependencies("animation"),s.getDependencies("camera")])}).then(function(r){const a={scene:r[0][n.scene||0],scenes:r[0],animations:r[1],cameras:r[2],asset:n.asset,parser:s,userData:{}};J(i,a,n),z(a,n),Promise.all(s._invokeAll(function(c){return c.afterRoot&&c.afterRoot(a)})).then(function(){e(a)})}).catch(t)}_markDefs(){const e=this.json.nodes||[],t=this.json.skins||[],s=this.json.meshes||[];for(let n=0,i=t.length;n<i;n++){const r=t[n].joints;for(let a=0,c=r.length;a<c;a++)e[r[a]].isBone=!0}for(let n=0,i=e.length;n<i;n++){const r=e[n];r.mesh!==void 0&&(this._addNodeRef(this.meshCache,r.mesh),r.skin!==void 0&&(s[r.mesh].isSkinnedMesh=!0)),r.camera!==void 0&&this._addNodeRef(this.cameraCache,r.camera)}}_addNodeRef(e,t){t!==void 0&&(e.refs[t]===void 0&&(e.refs[t]=e.uses[t]=0),e.refs[t]++)}_getNodeRef(e,t,s){if(e.refs[t]<=1)return s;const n=s.clone(),i=(r,a)=>{const c=this.associations.get(r);c!=null&&this.associations.set(a,c);for(const[l,h]of r.children.entries())i(h,a.children[l])};return i(s,n),n.name+="_instance_"+e.uses[t]++,n}_invokeOne(e){const t=Object.values(this.plugins);t.push(this);for(let s=0;s<t.length;s++){const n=e(t[s]);if(n)return n}return null}_invokeAll(e){const t=Object.values(this.plugins);t.unshift(this);const s=[];for(let n=0;n<t.length;n++){const i=e(t[n]);i&&s.push(i)}return s}getDependency(e,t){const s=e+":"+t;let n=this.cache.get(s);if(!n){switch(e){case"scene":n=this.loadScene(t);break;case"node":n=this.loadNode(t);break;case"mesh":n=this._invokeOne(function(i){return i.loadMesh&&i.loadMesh(t)});break;case"accessor":n=this.loadAccessor(t);break;case"bufferView":n=this._invokeOne(function(i){return i.loadBufferView&&i.loadBufferView(t)});break;case"buffer":n=this.loadBuffer(t);break;case"material":n=this._invokeOne(function(i){return i.loadMaterial&&i.loadMaterial(t)});break;case"texture":n=this._invokeOne(function(i){return i.loadTexture&&i.loadTexture(t)});break;case"skin":n=this.loadSkin(t);break;case"animation":n=this._invokeOne(function(i){return i.loadAnimation&&i.loadAnimation(t)});break;case"camera":n=this.loadCamera(t);break;default:throw new Error("Unknown type: "+e)}this.cache.add(s,n)}return n}getDependencies(e){let t=this.cache.get(e);if(!t){const s=this,n=this.json[e+(e==="mesh"?"es":"s")]||[];t=Promise.all(n.map(function(i,r){return s.getDependency(e,r)})),this.cache.add(e,t)}return t}loadBuffer(e){const t=this.json.buffers[e],s=this.fileLoader;if(t.type&&t.type!=="arraybuffer")throw new Error("THREE.GLTFLoader: "+t.type+" buffer type is not supported.");if(t.uri===void 0&&e===0)return Promise.resolve(this.extensions[v.KHR_BINARY_GLTF].body);const n=this.options;return new Promise(function(i,r){s.load(K.resolveURL(t.uri,n.path),i,void 0,function(){r(new Error('THREE.GLTFLoader: Failed to load buffer "'+t.uri+'".'))})})}loadBufferView(e){const t=this.json.bufferViews[e];return this.getDependency("buffer",t.buffer).then(function(s){const n=t.byteLength||0,i=t.byteOffset||0;return s.slice(i,i+n)})}loadAccessor(e){const t=this,s=this.json,n=this.json.accessors[e];if(n.bufferView===void 0&&n.sparse===void 0)return Promise.resolve(null);const i=[];return n.bufferView!==void 0?i.push(this.getDependency("bufferView",n.bufferView)):i.push(null),n.sparse!==void 0&&(i.push(this.getDependency("bufferView",n.sparse.indices.bufferView)),i.push(this.getDependency("bufferView",n.sparse.values.bufferView))),Promise.all(i).then(function(r){const a=r[0],c=gt[n.type],l=re[n.componentType],h=l.BYTES_PER_ELEMENT,u=h*c,f=n.byteOffset||0,p=n.bufferView!==void 0?s.bufferViews[n.bufferView].byteStride:void 0,_=n.normalized===!0;let m,d;if(p&&p!==u){const R=Math.floor(f/p),y="InterleavedBuffer:"+n.bufferView+":"+n.componentType+":"+R+":"+n.count;let g=t.cache.get(y);g||(m=new l(a,R*p,n.count*p/h),g=new hs(m,p/h),t.cache.add(y,g)),d=new Ds(g,c,f%p/h,_)}else a===null?m=new l(n.count*c):m=new l(a,f,n.count*c),d=new ze(m,c,_);if(n.sparse!==void 0){const R=gt.SCALAR,y=re[n.sparse.indices.componentType],g=n.sparse.indices.byteOffset||0,T=n.sparse.values.byteOffset||0,S=new y(r[1],g,n.sparse.count*R),x=new l(r[2],T,n.sparse.count*c);a!==null&&(d=new ze(d.array.slice(),d.itemSize,d.normalized));for(let E=0,L=S.length;E<L;E++){const A=S[E];if(d.setX(A,x[E*c]),c>=2&&d.setY(A,x[E*c+1]),c>=3&&d.setZ(A,x[E*c+2]),c>=4&&d.setW(A,x[E*c+3]),c>=5)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return d})}loadTexture(e){const t=this.json,s=this.options,i=t.textures[e].source,r=t.images[i];let a=this.textureLoader;if(r.uri){const c=s.manager.getHandler(r.uri);c!==null&&(a=c)}return this.loadTextureImage(e,i,a)}loadTextureImage(e,t,s){const n=this,i=this.json,r=i.textures[e],a=i.images[t],c=(a.uri||a.bufferView)+":"+r.sampler;if(this.textureCache[c])return this.textureCache[c];const l=this.loadImageSource(t,s).then(function(h){h.flipY=!1,r.name&&(h.name=r.name);const f=(i.samplers||{})[r.sampler]||{};return h.magFilter=pt[f.magFilter]||H,h.minFilter=pt[f.minFilter]||Pt,h.wrapS=mt[f.wrapS]||xe,h.wrapT=mt[f.wrapT]||xe,n.associations.set(h,{textures:e}),h}).catch(function(){return null});return this.textureCache[c]=l,l}loadImageSource(e,t){const s=this,n=this.json,i=this.options;if(this.sourceCache[e]!==void 0)return this.sourceCache[e].then(u=>u.clone());const r=n.images[e],a=self.URL||self.webkitURL;let c=r.uri||"",l=!1;if(r.bufferView!==void 0)c=s.getDependency("bufferView",r.bufferView).then(function(u){l=!0;const f=new Blob([u],{type:r.mimeType});return c=a.createObjectURL(f),c});else if(r.uri===void 0)throw new Error("THREE.GLTFLoader: Image "+e+" is missing URI and bufferView");const h=Promise.resolve(c).then(function(u){return new Promise(function(f,p){let _=f;t.isImageBitmapLoader===!0&&(_=function(m){const d=new Ke(m);d.needsUpdate=!0,f(d)}),t.load(K.resolveURL(u,i.path),_,void 0,p)})}).then(function(u){return l===!0&&a.revokeObjectURL(c),u.userData.mimeType=r.mimeType||sr(r.uri),u}).catch(function(u){throw console.error("THREE.GLTFLoader: Couldn't load texture",c),u});return this.sourceCache[e]=h,h}assignTexture(e,t,s,n){const i=this;return this.getDependency("texture",s.index).then(function(r){if(s.texCoord!==void 0&&s.texCoord!=0&&!(t==="aoMap"&&s.texCoord==1)&&console.warn("THREE.GLTFLoader: Custom UV set "+s.texCoord+" for texture "+t+" not yet supported."),i.extensions[v.KHR_TEXTURE_TRANSFORM]){const a=s.extensions!==void 0?s.extensions[v.KHR_TEXTURE_TRANSFORM]:void 0;if(a){const c=i.associations.get(r);r=i.extensions[v.KHR_TEXTURE_TRANSFORM].extendTexture(r,a),i.associations.set(r,c)}}return n!==void 0&&(r.encoding=n),e[t]=r,r})}assignFinalMaterial(e){const t=e.geometry;let s=e.material;const n=t.attributes.tangent===void 0,i=t.attributes.color!==void 0,r=t.attributes.normal===void 0;if(e.isPoints){const a="PointsMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new ds,me.prototype.copy.call(c,s),c.color.copy(s.color),c.map=s.map,c.sizeAttenuation=!1,this.cache.add(a,c)),s=c}else if(e.isLine){const a="LineBasicMaterial:"+s.uuid;let c=this.cache.get(a);c||(c=new fs,me.prototype.copy.call(c,s),c.color.copy(s.color),this.cache.add(a,c)),s=c}if(n||i||r){let a="ClonedMaterial:"+s.uuid+":";s.isGLTFSpecularGlossinessMaterial&&(a+="specular-glossiness:"),n&&(a+="derivative-tangents:"),i&&(a+="vertex-colors:"),r&&(a+="flat-shading:");let c=this.cache.get(a);c||(c=s.clone(),i&&(c.vertexColors=!0),r&&(c.flatShading=!0),n&&(c.normalScale&&(c.normalScale.y*=-1),c.clearcoatNormalScale&&(c.clearcoatNormalScale.y*=-1)),this.cache.add(a,c),this.associations.set(c,this.associations.get(s))),s=c}s.aoMap&&t.attributes.uv2===void 0&&t.attributes.uv!==void 0&&t.setAttribute("uv2",t.attributes.uv),e.material=s}getMaterialType(){return De}loadMaterial(e){const t=this,s=this.json,n=this.extensions,i=s.materials[e];let r;const a={},c=i.extensions||{},l=[];if(c[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){const u=n[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];r=u.getMaterialType(),l.push(u.extendParams(a,i,t))}else if(c[v.KHR_MATERIALS_UNLIT]){const u=n[v.KHR_MATERIALS_UNLIT];r=u.getMaterialType(),l.push(u.extendParams(a,i,t))}else{const u=i.pbrMetallicRoughness||{};if(a.color=new F(1,1,1),a.opacity=1,Array.isArray(u.baseColorFactor)){const f=u.baseColorFactor;a.color.fromArray(f),a.opacity=f[3]}u.baseColorTexture!==void 0&&l.push(t.assignTexture(a,"map",u.baseColorTexture,j)),a.metalness=u.metallicFactor!==void 0?u.metallicFactor:1,a.roughness=u.roughnessFactor!==void 0?u.roughnessFactor:1,u.metallicRoughnessTexture!==void 0&&(l.push(t.assignTexture(a,"metalnessMap",u.metallicRoughnessTexture)),l.push(t.assignTexture(a,"roughnessMap",u.metallicRoughnessTexture))),r=this._invokeOne(function(f){return f.getMaterialType&&f.getMaterialType(e)}),l.push(Promise.all(this._invokeAll(function(f){return f.extendMaterialParams&&f.extendMaterialParams(e,a)})))}i.doubleSided===!0&&(a.side=ps);const h=i.alphaMode||Ee.OPAQUE;if(h===Ee.BLEND?(a.transparent=!0,a.depthWrite=!1):(a.transparent=!1,h===Ee.MASK&&(a.alphaTest=i.alphaCutoff!==void 0?i.alphaCutoff:.5)),i.normalTexture!==void 0&&r!==ee&&(l.push(t.assignTexture(a,"normalMap",i.normalTexture)),a.normalScale=new k(1,1),i.normalTexture.scale!==void 0)){const u=i.normalTexture.scale;a.normalScale.set(u,u)}return i.occlusionTexture!==void 0&&r!==ee&&(l.push(t.assignTexture(a,"aoMap",i.occlusionTexture)),i.occlusionTexture.strength!==void 0&&(a.aoMapIntensity=i.occlusionTexture.strength)),i.emissiveFactor!==void 0&&r!==ee&&(a.emissive=new F().fromArray(i.emissiveFactor)),i.emissiveTexture!==void 0&&r!==ee&&l.push(t.assignTexture(a,"emissiveMap",i.emissiveTexture,j)),Promise.all(l).then(function(){let u;return r===Se?u=n[v.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(a):u=new r(a),i.name&&(u.name=i.name),z(u,i),t.associations.set(u,{materials:e}),i.extensions&&J(n,u,i),u})}createUniqueName(e){const t=ms.sanitizeNodeName(e||"");let s=t;for(let n=1;this.nodeNamesUsed[s];++n)s=t+"_"+n;return this.nodeNamesUsed[s]=!0,s}loadGeometries(e){const t=this,s=this.extensions,n=this.primitiveCache;function i(a){return s[v.KHR_DRACO_MESH_COMPRESSION].decodePrimitive(a,t).then(function(c){return Rt(c,a,t)})}const r=[];for(let a=0,c=e.length;a<c;a++){const l=e[a],h=tr(l),u=n[h];if(u)r.push(u.promise);else{let f;l.extensions&&l.extensions[v.KHR_DRACO_MESH_COMPRESSION]?f=i(l):f=Rt(new Ie,l,t),n[h]={primitive:l,promise:f},r.push(f)}}return Promise.all(r)}loadMesh(e){const t=this,s=this.json,n=this.extensions,i=s.meshes[e],r=i.primitives,a=[];for(let c=0,l=r.length;c<l;c++){const h=r[c].material===void 0?Zi(this.cache):this.getDependency("material",r[c].material);a.push(h)}return a.push(t.loadGeometries(r)),Promise.all(a).then(function(c){const l=c.slice(0,c.length-1),h=c[c.length-1],u=[];for(let p=0,_=h.length;p<_;p++){const m=h[p],d=r[p];let R;const y=l[p];if(d.mode===G.TRIANGLES||d.mode===G.TRIANGLE_STRIP||d.mode===G.TRIANGLE_FAN||d.mode===void 0)R=i.isSkinnedMesh===!0?new gs(m,y):new Ct(m,y),R.isSkinnedMesh===!0&&!R.geometry.attributes.skinWeight.normalized&&R.normalizeSkinWeights(),d.mode===G.TRIANGLE_STRIP?R.geometry=Tt(R.geometry,Ps):d.mode===G.TRIANGLE_FAN&&(R.geometry=Tt(R.geometry,Ot));else if(d.mode===G.LINES)R=new _s(m,y);else if(d.mode===G.LINE_STRIP)R=new Rs(m,y);else if(d.mode===G.LINE_LOOP)R=new Ts(m,y);else if(d.mode===G.POINTS)R=new ys(m,y);else throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+d.mode);Object.keys(R.geometry.morphAttributes).length>0&&er(R,i),R.name=t.createUniqueName(i.name||"mesh_"+e),z(R,i),d.extensions&&J(n,R,d),t.assignFinalMaterial(R),u.push(R)}for(let p=0,_=u.length;p<_;p++)t.associations.set(u[p],{meshes:e,primitives:p});if(u.length===1)return u[0];const f=new ge;t.associations.set(f,{meshes:e});for(let p=0,_=u.length;p<_;p++)f.add(u[p]);return f})}loadCamera(e){let t;const s=this.json.cameras[e],n=s[s.type];if(!n){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}return s.type==="perspective"?t=new we(Es.radToDeg(n.yfov),n.aspectRatio||1,n.znear||1,n.zfar||2e6):s.type==="orthographic"&&(t=new se(-n.xmag,n.xmag,n.ymag,-n.ymag,n.znear,n.zfar)),s.name&&(t.name=this.createUniqueName(s.name)),z(t,s),Promise.resolve(t)}loadSkin(e){const t=this.json.skins[e],s={joints:t.joints};return t.inverseBindMatrices===void 0?Promise.resolve(s):this.getDependency("accessor",t.inverseBindMatrices).then(function(n){return s.inverseBindMatrices=n,s})}loadAnimation(e){const s=this.json.animations[e],n=[],i=[],r=[],a=[],c=[];for(let l=0,h=s.channels.length;l<h;l++){const u=s.channels[l],f=s.samplers[u.sampler],p=u.target,_=p.node!==void 0?p.node:p.id,m=s.parameters!==void 0?s.parameters[f.input]:f.input,d=s.parameters!==void 0?s.parameters[f.output]:f.output;n.push(this.getDependency("node",_)),i.push(this.getDependency("accessor",m)),r.push(this.getDependency("accessor",d)),a.push(f),c.push(p)}return Promise.all([Promise.all(n),Promise.all(i),Promise.all(r),Promise.all(a),Promise.all(c)]).then(function(l){const h=l[0],u=l[1],f=l[2],p=l[3],_=l[4],m=[];for(let R=0,y=h.length;R<y;R++){const g=h[R],T=u[R],S=f[R],x=p[R],E=_[R];if(g===void 0)continue;g.updateMatrix();let L;switch(B[E.path]){case B.weights:L=Os;break;case B.rotation:L=We;break;case B.position:case B.scale:default:L=Ns;break}const A=g.name?g.name:g.uuid,M=x.interpolation!==void 0?Qi[x.interpolation]:Nt,w=[];B[E.path]===B.weights?g.traverse(function(I){I.morphTargetInfluences&&w.push(I.name?I.name:I.uuid)}):w.push(A);let C=S.array;if(S.normalized){const I=Me(C.constructor),N=new Float32Array(C.length);for(let b=0,oe=C.length;b<oe;b++)N[b]=C[b]*I;C=N}for(let I=0,N=w.length;I<N;I++){const b=new L(w[I]+"."+B[E.path],T.array,C,M);x.interpolation==="CUBICSPLINE"&&(b.createInterpolant=function(D){const P=this instanceof We?qi:es;return new P(this.times,this.values,this.getValueSize()/3,D)},b.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline=!0),m.push(b)}}const d=s.name?s.name:"animation_"+e;return new As(d,void 0,m)})}createNodeMesh(e){const t=this.json,s=this,n=t.nodes[e];return n.mesh===void 0?null:s.getDependency("mesh",n.mesh).then(function(i){const r=s._getNodeRef(s.meshCache,n.mesh,i);return n.weights!==void 0&&r.traverse(function(a){if(a.isMesh)for(let c=0,l=n.weights.length;c<l;c++)a.morphTargetInfluences[c]=n.weights[c]}),r})}loadNode(e){const t=this.json,s=this.extensions,n=this,i=t.nodes[e],r=i.name?n.createUniqueName(i.name):"";return function(){const a=[],c=n._invokeOne(function(l){return l.createNodeMesh&&l.createNodeMesh(e)});return c&&a.push(c),i.camera!==void 0&&a.push(n.getDependency("camera",i.camera).then(function(l){return n._getNodeRef(n.cameraCache,i.camera,l)})),n._invokeAll(function(l){return l.createNodeAttachment&&l.createNodeAttachment(e)}).forEach(function(l){a.push(l)}),Promise.all(a)}().then(function(a){let c;if(i.isBone===!0?c=new xs:a.length>1?c=new ge:a.length===1?c=a[0]:c=new Pe,c!==a[0])for(let l=0,h=a.length;l<h;l++)c.add(a[l]);if(i.name&&(c.userData.name=i.name,c.name=r),z(c,i),i.extensions&&J(s,c,i),i.matrix!==void 0){const l=new q;l.fromArray(i.matrix),c.applyMatrix4(l)}else i.translation!==void 0&&c.position.fromArray(i.translation),i.rotation!==void 0&&c.quaternion.fromArray(i.rotation),i.scale!==void 0&&c.scale.fromArray(i.scale);return n.associations.has(c)||n.associations.set(c,{}),n.associations.get(c).nodes=e,c})}loadScene(e){const t=this.json,s=this.extensions,n=this.json.scenes[e],i=this,r=new ge;n.name&&(r.name=i.createUniqueName(n.name)),z(r,n),n.extensions&&J(s,r,n);const a=n.nodes||[],c=[];for(let l=0,h=a.length;l<h;l++)c.push(ts(a[l],r,t,i));return Promise.all(c).then(function(){const l=h=>{const u=new Map;for(const[f,p]of i.associations)(f instanceof me||f instanceof Ke)&&u.set(f,p);return h.traverse(f=>{const p=i.associations.get(f);p!=null&&u.set(f,p)}),u};return i.associations=l(r),r})}}function ts(o,e,t,s){const n=t.nodes[o];return s.getDependency("node",o).then(function(i){if(n.skin===void 0)return i;let r;return s.getDependency("skin",n.skin).then(function(a){r=a;const c=[];for(let l=0,h=r.joints.length;l<h;l++)c.push(s.getDependency("node",r.joints[l]));return Promise.all(c)}).then(function(a){return i.traverse(function(c){if(!c.isMesh)return;const l=[],h=[];for(let u=0,f=a.length;u<f;u++){const p=a[u];if(p){l.push(p);const _=new q;r.inverseBindMatrices!==void 0&&_.fromArray(r.inverseBindMatrices.array,u*16),h.push(_)}else console.warn('THREE.GLTFLoader: Joint "%s" could not be found.',r.joints[u])}c.bind(new ws(l,h),c.matrixWorld)}),i})}).then(function(i){e.add(i);const r=[];if(n.children){const a=n.children;for(let c=0,l=a.length;c<l;c++){const h=a[c];r.push(ts(h,i,t,s))}}return Promise.all(r)})}function ir(o,e,t){const s=e.attributes,n=new Gs;if(s.POSITION!==void 0){const a=t.json.accessors[s.POSITION],c=a.min,l=a.max;if(c!==void 0&&l!==void 0){if(n.set(new U(c[0],c[1],c[2]),new U(l[0],l[1],l[2])),a.normalized){const h=Me(re[a.componentType]);n.min.multiplyScalar(h),n.max.multiplyScalar(h)}}else{console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.");return}}else return;const i=e.targets;if(i!==void 0){const a=new U,c=new U;for(let l=0,h=i.length;l<h;l++){const u=i[l];if(u.POSITION!==void 0){const f=t.json.accessors[u.POSITION],p=f.min,_=f.max;if(p!==void 0&&_!==void 0){if(c.setX(Math.max(Math.abs(p[0]),Math.abs(_[0]))),c.setY(Math.max(Math.abs(p[1]),Math.abs(_[1]))),c.setZ(Math.max(Math.abs(p[2]),Math.abs(_[2]))),f.normalized){const m=Me(re[f.componentType]);c.multiplyScalar(m)}a.max(c)}else console.warn("THREE.GLTFLoader: Missing min/max properties for accessor POSITION.")}}n.expandByVector(a)}o.boundingBox=n;const r=new Hs;n.getCenter(r.center),r.radius=n.min.distanceTo(n.max)/2,o.boundingSphere=r}function Rt(o,e,t){const s=e.attributes,n=[];function i(r,a){return t.getDependency("accessor",r).then(function(c){o.setAttribute(a,c)})}for(const r in s){const a=ve[r]||r.toLowerCase();a in o.attributes||n.push(i(s[r],a))}if(e.indices!==void 0&&!o.index){const r=t.getDependency("accessor",e.indices).then(function(a){o.setIndex(a)});n.push(r)}return z(o,e),ir(o,e,t),Promise.all(n).then(function(){return e.targets!==void 0?Ji(o,e.targets,t):o})}function Tt(o,e){let t=o.getIndex();if(t===null){const r=[],a=o.getAttribute("position");if(a!==void 0){for(let c=0;c<a.count;c++)r.push(c);o.setIndex(r),t=o.getIndex()}else return console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Undefined position attribute. Processing not possible."),o}const s=t.count-2,n=[];if(e===Ot)for(let r=1;r<=s;r++)n.push(t.getX(0)),n.push(t.getX(r)),n.push(t.getX(r+1));else for(let r=0;r<s;r++)r%2===0?(n.push(t.getX(r)),n.push(t.getX(r+1)),n.push(t.getX(r+2))):(n.push(t.getX(r+2)),n.push(t.getX(r+1)),n.push(t.getX(r)));n.length/3!==s&&console.error("THREE.GLTFLoader.toTrianglesDrawMode(): Unable to generate correct amount of triangles.");const i=o.clone();return i.setIndex(n),i}class ss{constructor(){this._listeners={}}on(e,t,s){this._listeners[e]?this._listeners[e].push({callback:t,isOnce:s}):this._listeners[e]=[{callback:t,isOnce:s}]}off(e,t){if(!t)throw new Error("取消事件时需要传入原回调函数");const s=this._listeners[e];if(s&&s.length>0){for(let n=0;n<s.length;n++)if(s[n].callback===t){s.splice(n,1);break}}}emit(e,t){const s=this._listeners[e];if(s&&s.length>0)for(let n=0;n<s.length;n++){const i=s[n];i.callback.call(this,t),i.isOnce&&(s.splice(n,1),n--)}}}function rr(o){o.traverse(e=>{be(e)})}function be(o){const e=s=>{s.geometry&&s.geometry.dispose(),s.material&&s.material.dispose&&s.material.dispose(),s.material.texture&&s.material.texture.dispose&&s.material.texture.dispose()},t=s=>{let n=s.children.filter(i=>i);n.forEach(i=>{i.children.length?t(i):i.isMesh&&e(i)}),n=null};t(o)}var or=Object.defineProperty,yt=Object.getOwnPropertySymbols,ar=Object.prototype.hasOwnProperty,cr=Object.prototype.propertyIsEnumerable,Et=(o,e,t)=>e in o?or(o,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):o[e]=t,At=(o,e)=>{for(var t in e||(e={}))ar.call(e,t)&&Et(o,t,e[t]);if(yt)for(var t of yt(e))cr.call(e,t)&&Et(o,t,e[t]);return o};class lr extends ss{constructor(e,t){super(),this.frameTimer=-1,this.needsUpdate=!1,t=t||{},this.customCoords=e.customCoords,this.center=t.customCoordsCenter||e.getCenter().toArray(),this.customCoords.lngLatsToCoords([this.center]);const s={zooms:[2,20],opacity:1,alpha:!1,antialias:!1,visible:!0,zIndex:120,createCanvas:!1,webGLRendererParameters:{}};this.options=Object.assign({},s,t),this.map=e,this.init()}init(){this.options.createCanvas?this.createCustomCanvasLayer():this.createGlCustomLayer(),this._updateSizeFn=()=>{this.updateRendererSize()},this.map.on("resize",this._updateSizeFn)}updateRendererSize(){var e;const t=this.map.getContainer(),s=t.offsetWidth,n=t.offsetHeight;(e=this.renderer)===null||e===void 0||e.setSize(s,n),this.map.getView().type==="3D"&&(this.camera.aspect=s/n)}createGlCustomLayer(){const e=this.options,t=this.map,s={zooms:e.zooms,opacity:e.opacity,visible:e.visible,zIndex:e.zIndex,init:n=>{const i=t.getContainer(),r=i.offsetWidth,a=i.offsetHeight;let c;t.getView().type==="3D"?c=new we(60,r/a,100,1<<30):c=new se(r/-2,r/2,a/2,a/-2,1,1e3);const l=new $e(At({context:n,alpha:e.alpha,antialias:e.antialias},e.webGLRendererParameters));l.setSize(r,a),l.autoClear=!1;const h=new Ve;this.camera=c,this.renderer=l,this.scene=h,e.onInit&&e.onInit(l,h,c),this.animate(),this.emit("complete")},render:()=>{var n,i,r;(n=this.renderer)===null||n===void 0||n.resetState(),this.customCoords.setCenter(this.center);const a=this.camera;if(t.getView().type==="3D"){const{near:c,far:l,fov:h,up:u,lookAt:f,position:p}=this.customCoords.getCameraParams();a.near=c,a.far=l,a.fov=h,a.position.set(...p),a.up.set(...u),a.lookAt(...f),a.updateProjectionMatrix()}else{const{top:c,bottom:l,left:h,right:u,position:f}=this.customCoords.getCameraParams();a.top=c,a.bottom=l,a.left=h,a.right=u,a.position.set(...f),a.updateProjectionMatrix()}this.camera=a,e.onRender?e.onRender(this.renderer,this.scene,this.camera):(i=this.renderer)===null||i===void 0||i.render(this.scene,a),(r=this.renderer)===null||r===void 0||r.resetState()}};this.layer=new AMap.GLCustomLayer(s),this.layer.setMap(t)}createCustomCanvasLayer(){const e=this.options,t=this.map,s=document.createElement("canvas");this.canvas=s;const n=t.getContainer(),i=n.offsetWidth,r=n.offsetHeight;let a;t.getView().type==="3D"?a=new we(60,i/r,100,1<<30):a=new se(i/-2,i/2,r/2,r/-2,1,1e3);const c=new $e(At({alpha:e.alpha,antialias:e.antialias,canvas:s},e.webGLRendererParameters));c.setSize(i,r),c.setPixelRatio(window.devicePixelRatio);const l=new Ve;this.camera=a,this.renderer=c,c.setClearColor(0,0),this.scene=l;const h={zooms:e.zooms,opacity:e.opacity,visible:e.visible,zIndex:e.zIndex,alwaysRender:!0,render:()=>{var u;this.customCoords.setCenter(this.center);const f=this.camera;if(t.getView().type==="3D"){const{near:p,far:_,fov:m,up:d,lookAt:R,position:y}=this.customCoords.getCameraParams();f.near=p,f.far=_,f.fov=m,f.position.set(...y),f.up.set(...d),f.lookAt(...R),f.updateProjectionMatrix()}else{const{top:p,bottom:_,left:m,right:d,position:R}=this.customCoords.getCameraParams();f.top=p,f.bottom=_,f.left=m,f.right=d,f.position.set(...R),f.updateProjectionMatrix()}this.camera=f,e.onRender?e.onRender(this.renderer,this.scene,this.camera):(u=this.renderer)===null||u===void 0||u.render(this.scene,f)}};this.layer=new AMap.CustomLayer(s,h),this.layer.setMap(t),setTimeout(()=>{e.onInit&&e.onInit(c,l,a),this.animate(),this.emit("complete")},10)}update(){this.needsUpdate=!0}animate(){var e;this.needsUpdate&&(this.options.createCanvas?this.options.onRender?this.options.onRender(this.renderer,this.scene,this.camera):(e=this.renderer)===null||e===void 0||e.render(this.scene,this.camera):this.refreshMap(),this.needsUpdate=!1),this.frameTimer=requestAnimationFrame(()=>{this.animate()})}refreshMap(){this.map&&this.map.render()}convertLngLat(e){return this.customCoords.setCenter(this.center),this.customCoords.lngLatsToCoords([e])[0]}add(e){var t;(t=this.scene)===null||t===void 0||t.add(e),this.refreshMap()}remove(e){var t;(t=this.scene)===null||t===void 0||t.remove(e),this.refreshMap()}getScene(){return this.scene}getCamera(){return this.camera}getRender(){return this.renderer}destroy(){var e;cancelAnimationFrame(this.frameTimer),this.map.off("resize",this._updateSizeFn),this._updateSizeFn=void 0,this.layer.setMap(null),this.customCoords=null,rr(this.scene),this.scene=void 0,this.camera=void 0,(e=this.renderer)===null||e===void 0||e.dispose(),this.renderer=void 0,this.layer=null,this.map=null,Bs.clear(),this.options=null}getMap(){return this.map?this.map:null}getOpacity(){return this.layer.getOpacity()}setOpacity(e){this.layer.setOpacity(e)}getZooms(){return this.layer.getZooms()}setZooms(e){this.layer.setZooms(e)}getzIndex(){return this.layer.getzIndex()}setzIndex(e){this.layer.setzIndex(e)}show(){this.layer.show()}hide(){this.layer.hide()}}class wr extends ss{constructor(e,t){super(),this.linerAnimationFrame=-1,this.layer=e,t=Object.assign({},{url:"",position:[0,0],height:0,rotation:{x:0,y:0,z:0},scale:1,angle:0,useModelCache:!1},t),this.init(t)}init(e){if(e.useModelCache)if(window._THREE_GLTF_CACHE=window._THREE_GLTF_CACHE||{},window._THREE_GLTF_CACHE[e.url])if(window._THREE_GLTF_CACHE[e.url].loaded){const t=window._THREE_GLTF_CACHE[e.url].model;this._loadModel(t.scene.clone(!0),t.animations.map(s=>s.clone()),e)}else this.getModelTimer=setTimeout(()=>{this.init(e)},10);else{window._THREE_GLTF_CACHE[e.url]={loaded:!1};const t=new dt;e.configLoader&&e.configLoader(t),t.load(e.url,s=>{window._THREE_GLTF_CACHE[e.url].model=s,window._THREE_GLTF_CACHE[e.url].loaded=!0,this._loadModel(s.scene.clone(!0),s.animations.map(n=>n.clone()),e)})}else{const t=new dt;e.configLoader&&e.configLoader(t),t.load(e.url,s=>{this._loadModel(s.scene,s.animations,e)})}}_loadModel(e,t,s){this.layer.add(e),this.object=e,this.animations=t,this.setScale(s.scale),this.setRotation(s.rotation),this.setAngle(s.angle),this.setPosition(s.position),this.setHeight(s.height),s.onLoaded&&s.onLoaded(e,t),this.emit("complete",{target:e,animations:t})}setScale(e){let t;typeof e=="number"?t={x:e,y:e,z:e}:t=e,this.object.scale.set(t.x,t.y,t.z),this.refresh()}setPosition(e){const t=this.layer.convertLngLat(e);this.object.position.setX(t[0]),this.object.position.setY(t[1]),this.refresh()}setRotation(e){if(e){const t=Math.PI/180*(e.x||0),s=Math.PI/180*(e.y||0),n=Math.PI/180*(e.z||0);this.object.rotation.set(t,s,n),this.refresh()}}setAngle(e){const t=this.object.rotation.x,s=this.object.rotation.z,n=Math.PI/180*e;this.object.rotation.set(t,n,s),this.refresh()}setHeight(e){e!==void 0&&(this.object.position.setZ(e),this.refresh())}getAnimations(){return this.animations}getObject(){return this.object}refresh(){this.layer.update()}show(){this.object.visible=!0,this.refresh()}hide(){this.object.visible=!1,this.refresh()}animate(e){this.linerAnimationFrame=requestAnimationFrame(()=>{this.animate(e)}),e()}startAnimations(){if(this.animations){const e=this.animations,t=new ks(this.object),s={};for(let i=0;i<e.length;i++){const r=e[i];s[r.name]=t.clipAction(r)}const n=new Fe;for(const i in s)s[i].play();this.animate(()=>{const i=n.getDelta();t&&t.update(i),this.refresh()})}}stopAnimations(){cancelAnimationFrame(this.linerAnimationFrame)}remove(){this.object&&this.layer.remove(this.object)}destroy(){this.stopAnimations(),this.object&&(be(this.object),this.object=null,this.layer=null)}static clearAllModelCache(){window._THREE_GLTF_CACHE&&(Object.values(window._THREE_GLTF_CACHE).forEach(e=>{e.model&&be(e.model.scene)}),window._THREE_GLTF_CACHE={})}}class Lr extends Pe{constructor(e=document.createElement("div")){super(),this.isCSS2DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.center=new k(.5,.5),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){super.copy(e,t);const s=this;return s.element=e.element.cloneNode(!0),s.center=e.center,s}}const $=new U,xt=new q,wt=new q,Lt=new U,St=new U;class ur{constructor(e={}){const t=this;let s,n,i,r;const a={objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c,this.getSize=function(){return{width:s,height:n}},this.render=function(p,_){p.matrixWorldAutoUpdate===!0&&p.updateMatrixWorld(),_.parent===null&&_.matrixWorldAutoUpdate===!0&&_.updateMatrixWorld(),xt.copy(_.matrixWorldInverse),wt.multiplyMatrices(_.projectionMatrix,xt),l(p,p,_),f(p)},this.setSize=function(p,_){s=p,n=_,i=s/2,r=n/2,c.style.width=p+"px",c.style.height=_+"px"};function l(p,_,m){if(p.isCSS2DObject){$.setFromMatrixPosition(p.matrixWorld),$.applyMatrix4(wt);const d=p.visible===!0&&$.z>=-1&&$.z<=1&&p.layers.test(m.layers)===!0;if(p.element.style.display=d===!0?"":"none",d===!0){p.onBeforeRender(t,_,m);const y=p.element;y.style.transform="translate("+-100*p.center.x+"%,"+-100*p.center.y+"%)translate("+($.x*i+i)+"px,"+(-$.y*r+r)+"px)",y.parentNode!==c&&c.appendChild(y),p.onAfterRender(t,_,m)}const R={distanceToCameraSquared:h(m,p)};a.objects.set(p,R)}for(let d=0,R=p.children.length;d<R;d++)l(p.children[d],_,m)}function h(p,_){return Lt.setFromMatrixPosition(p.matrixWorld),St.setFromMatrixPosition(_.matrixWorld),Lt.distanceToSquared(St)}function u(p){const _=[];return p.traverse(function(m){m.isCSS2DObject&&_.push(m)}),_}function f(p){const _=u(p).sort(function(d,R){if(d.renderOrder!==R.renderOrder)return R.renderOrder-d.renderOrder;const y=a.objects.get(d).distanceToCameraSquared,g=a.objects.get(R).distanceToCameraSquared;return y-g}),m=_.length;for(let d=0,R=_.length;d<R;d++)_[d].element.style.zIndex=m-d}}}const vt=new U,hr=new Gt,Mt=new U;class Sr extends Pe{constructor(e=document.createElement("div")){super(),this.isCSS3DObject=!0,this.element=e,this.element.style.position="absolute",this.element.style.pointerEvents="auto",this.element.style.userSelect="none",this.element.setAttribute("draggable",!1),this.addEventListener("removed",function(){this.traverse(function(t){t.element instanceof Element&&t.element.parentNode!==null&&t.element.parentNode.removeChild(t.element)})})}copy(e,t){return super.copy(e,t),this.element=e.element.cloneNode(!0),this}}const O=new q,dr=new q;class fr{constructor(e={}){const t=this;let s,n,i,r;const a={camera:{style:""},objects:new WeakMap},c=e.element!==void 0?e.element:document.createElement("div");c.style.overflow="hidden",this.domElement=c;const l=document.createElement("div");l.style.transformOrigin="0 0",l.style.pointerEvents="none",c.appendChild(l);const h=document.createElement("div");h.style.transformStyle="preserve-3d",l.appendChild(h),this.getSize=function(){return{width:s,height:n}},this.render=function(m,d){const R=d.projectionMatrix.elements[5]*r;d.view&&d.view.enabled?(l.style.transform=`translate( ${-d.view.offsetX*(s/d.view.width)}px, ${-d.view.offsetY*(n/d.view.height)}px )`,l.style.transform+=`scale( ${d.view.fullWidth/d.view.width}, ${d.view.fullHeight/d.view.height} )`):l.style.transform="",m.matrixWorldAutoUpdate===!0&&m.updateMatrixWorld(),d.parent===null&&d.matrixWorldAutoUpdate===!0&&d.updateMatrixWorld();let y,g;d.isOrthographicCamera&&(y=-(d.right+d.left)/2,g=(d.top+d.bottom)/2);const T=d.view&&d.view.enabled?d.view.height/d.view.fullHeight:1,S=d.isOrthographicCamera?`scale( ${T} )scale(`+R+")translate("+u(y)+"px,"+u(g)+"px)"+f(d.matrixWorldInverse):`scale( ${T} )translateZ(`+R+"px)"+f(d.matrixWorldInverse),E=(d.isPerspectiveCamera?"perspective("+R+"px) ":"")+S+"translate("+i+"px,"+r+"px)";a.camera.style!==E&&(h.style.transform=E,a.camera.style=E),_(m,m,d)},this.setSize=function(m,d){s=m,n=d,i=s/2,r=n/2,c.style.width=m+"px",c.style.height=d+"px",l.style.width=m+"px",l.style.height=d+"px",h.style.width=m+"px",h.style.height=d+"px"};function u(m){return Math.abs(m)<1e-10?0:m}function f(m){const d=m.elements;return"matrix3d("+u(d[0])+","+u(-d[1])+","+u(d[2])+","+u(d[3])+","+u(d[4])+","+u(-d[5])+","+u(d[6])+","+u(d[7])+","+u(d[8])+","+u(-d[9])+","+u(d[10])+","+u(d[11])+","+u(d[12])+","+u(-d[13])+","+u(d[14])+","+u(d[15])+")"}function p(m){const d=m.elements;return"translate(-50%,-50%)"+("matrix3d("+u(d[0])+","+u(d[1])+","+u(d[2])+","+u(d[3])+","+u(-d[4])+","+u(-d[5])+","+u(-d[6])+","+u(-d[7])+","+u(d[8])+","+u(d[9])+","+u(d[10])+","+u(d[11])+","+u(d[12])+","+u(d[13])+","+u(d[14])+","+u(d[15])+")")}function _(m,d,R,y){if(m.isCSS3DObject){const g=m.visible===!0&&m.layers.test(R.layers)===!0;if(m.element.style.display=g===!0?"":"none",g===!0){m.onBeforeRender(t,d,R);let T;m.isCSS3DSprite?(O.copy(R.matrixWorldInverse),O.transpose(),m.rotation2D!==0&&O.multiply(dr.makeRotationZ(m.rotation2D)),m.matrixWorld.decompose(vt,hr,Mt),O.setPosition(vt),O.scale(Mt),O.elements[3]=0,O.elements[7]=0,O.elements[11]=0,O.elements[15]=1,T=p(O)):T=p(m.matrixWorld);const S=m.element,x=a.objects.get(m);if(x===void 0||x.style!==T){S.style.transform=T;const E={style:T};a.objects.set(m,E)}S.parentNode!==h&&h.appendChild(S),m.onAfterRender(t,d,R)}}for(let g=0,T=m.children.length;g<T;g++)_(m.children[g],d,R)}}}class pr extends lr{constructor(e,t,s){t.onInit=(n,i)=>{var r;if(this.raycaster=new js,t.axesHelper){const a=new zs(1e4);i.add(a)}(r=this.renderer)==null||r.setPixelRatio(window.devicePixelRatio),t.createCssRender&&this.creatCssRenders(e),this.createEffect(),this.createLights(t.lights||[]),this.createHDR(t.hdr),this.bindEvents(),s&&s()},t.onRender=(n,i,r)=>{var a,c,l,h;this.passNum>0?(a=this.effectComposer)==null||a.render(this.clock.getDelta()):((c=this.renderer)==null||c.render(this.scene,r),(l=this.css2DRenderer)==null||l.render(this.scene,r),(h=this.css3DRenderer)==null||h.render(this.scene,r))},super(e,t),this.lightTypes={AmbientLight:Ht,DirectionalLight:Dt,HemisphereLight:Ks,PointLight:Ft,RectAreaLight:Ws,SpotLight:It},this.passNum=0,this.passList=[],this.clock=new Fe,this.preHoverGroup=null,this.css2DRenderer=null,this.css3DRenderer=null,this.mouse=new k}updateRendererSize(){var n,i,r;const e=this.map.getContainer(),t=e.offsetWidth,s=e.offsetHeight;(n=this.renderer)==null||n.setSize(t,s),(i=this.css2DRenderer)==null||i.setSize(t,s),(r=this.css3DRenderer)==null||r.setSize(t,s),this.map.getView().type==="3D"&&(this.camera.aspect=t/s)}updateEffectComposerSize(){var e,t;if(this.effectComposer&&this.renderer){const s=this.renderer.getSize(new k);this.effectComposer.setSize(s.x,s.y),(e=this.css2DRenderer)==null||e.setSize(s.x,s.y),(t=this.css3DRenderer)==null||t.setSize(s.x,s.y)}}createEffect(){var t,s,n;const e=(t=this.renderer)==null?void 0:t.getSize(new k);this.effectComposer=new bi(this.renderer),this.effectComposer.setSize(e==null?void 0:e.x,e==null?void 0:e.y),(s=this.css2DRenderer)==null||s.setSize(e==null?void 0:e.x,e==null?void 0:e.y),(n=this.css3DRenderer)==null||n.setSize(e==null?void 0:e.x,e==null?void 0:e.y)}creatCssRenders(e){this.css2DRenderer=new ur,this.css2DRenderer.domElement.style.position="absolute",this.css2DRenderer.domElement.style.left="0",this.css2DRenderer.domElement.style.top="0",this.css3DRenderer=new fr,this.css3DRenderer.domElement.style.position="absolute",this.css3DRenderer.domElement.style.left="0",this.css3DRenderer.domElement.style.top="0";const t=e.getContainer().querySelector(".amap-markers");t.appendChild(this.css2DRenderer.domElement),t.appendChild(this.css3DRenderer.domElement)}addPass(e){var t;(t=this.effectComposer)==null||t.addPass(e),this.passNum++,this.passList.push(e)}removePass(e){var s;const t=this.passList.indexOf(e);t!==-1&&this.passList.splice(t,1),(s=this.effectComposer)==null||s.removePass(e),this.passNum--}createLights(e){const t={type:"DirectionalLight",args:[]};e&&e.length>0&&e.forEach(s=>{if(s=Xe({},t,s),this.lightTypes[s.type]){const n=new this.lightTypes[s.type](...s.args),i=s.position,r=s.lookAt;i&&n.position.set(i.x,i.y,i.z),r&&n.lookAt(r.x,r.y,r.z),this.add(n)}else console.warn("当前设置的灯光类型不存在")})}createHDR(e){if(!e)return;const t=Xe({},{urls:[],path:"/",exposure:1},e),s=this.renderer;s.physicallyCorrectLights=!0,s.outputEncoding=j,s.toneMappingExposure=t.exposure;const n=t.urls;let i=new $s(s);i.compileCubemapShader();const r=new Li().setPath(t.path).load(n,()=>{const a=i.fromCubemap(r);r.magFilter=H,r.needsUpdate=!0,this.envMap=a?a.texture:null,this.addEnvMap(this.scene),i.dispose(),i=null,this.refreshMap()})}addEnvMap(e){this.scene.environment=this.envMap}bindEvents(){this.clickFun=te(this._clickEvent,this),this.hoverFun=te(this._hoverEvent,this),this.resizeFun=te(this.updateEffectComposerSize,this),this.canvas?(this.canvas.addEventListener("click",this.clickFun,!1),this.canvas.addEventListener("mousemove",this.hoverFun,!1)):(this.map.on("click",this.clickFun),this.map.on("mousemove",this.hoverFun)),this.map.on("resize",this.resizeFun)}ubBindEvents(){this.map.off("click",this.clickFun),this.map.off("mousemove",this.hoverFun),this.map.on("off",this.resizeFun)}_getOriginEvent(e){return e.originEvent?e.originEvent:e}_clickEvent(e){e=this._getOriginEvent(e);const t=this._intersectGltf(e);t&&(t.userData.$vue&&t.userData.$vue.$emit("click",t),this.emit("click",t))}_hoverEvent(e){e=this._getOriginEvent(e);const t=this._intersectGltf(e);t&&(t.userData.isHover||(t.userData.isHover=!0,t.userData.$vue?t.userData.$vue.$emit("mouseover",t):this.emit("mouseover",t))),this.preHoverGroup&&(!t||this.preHoverGroup.uuid!==t.uuid)&&(this.preHoverGroup.userData.$vue?this.preHoverGroup.userData.$vue.$emit("mouseout",this.preHoverGroup):this.emit("mouseout",this.preHoverGroup),this.preHoverGroup.userData.isHover=!1),this.preHoverGroup=t}_intersectGltf(e){var l,h;const t=this.map.getContainer(),s=t.getBoundingClientRect(),n=s.top+window.pageYOffset-t.clientTop,i=s.left+window.pageXOffset-t.clientLeft;this.mouse.x=(e.x+window.pageXOffset-i)/s.width*2-1,this.mouse.y=-((e.y+window.pageYOffset-n)/s.height)*2+1;const r=this.camera;(l=this.raycaster)==null||l.setFromCamera(this.mouse,r);const a=(h=this.raycaster)==null?void 0:h.intersectObjects([this.scene],!0),c=a==null?void 0:a.length;if(c&&c>0){let u=null;for(let f=0;f<c;f++){const p=a[f];if(u=this._getGroup(p.object),u!==null)break}return u}return null}_getGroup(e){return e?e.userData.acceptEvent?e:this._getGroup(e.parent):null}destroy(){var e,t,s,n;this.ubBindEvents(),this.envMap&&(this.envMap.dispose(),this.envMap=null),(t=(e=this.css2DRenderer)==null?void 0:e.domElement)==null||t.remove(),(n=(s=this.css3DRenderer)==null?void 0:s.domElement)==null||n.remove(),super.destroy(),this.lightTypes=null,this.raycaster=void 0}}const mr=kt({name:"ElAmapLayerThree",inheritAttrs:!1,__name:"ThreeLayer",props:zt({lights:{type:Array,default(){return[]}},hdr:{type:Object},zooms:{type:Array,default(){return[2,20]}},opacity:{type:Number},alpha:{type:Boolean,default:!0},antialias:{type:Boolean,default:!1},customCoordsCenter:{type:Array,default(){return null}},axesHelper:{type:Boolean,default:!1},createCanvas:{type:Boolean,default:!1},webGLRendererParameters:{type:Object,default(){}},createCssRender:{type:Boolean,default:!1}}),emits:["init"],setup(o,{expose:e,emit:t}){const s=[],n={$amapComponent:void 0,addChildComponent(g){s.push(g)},isDestroy:!1};en(an,n);const i=t;let r;const{$$getInstance:a,parentInstance:c}=Kt((g,T)=>new Promise(S=>{r=new pr(T,g,()=>{n.$amapComponent=r,S(r)})}),{emits:i,provideData:n,needInitComponents:s,destroyComponent(){r&&(r.destroy(),r=null)}}),l=g=>r.convertLngLat(g),h=g=>{r.add(g)},u=g=>{r.remove(g)},f=g=>{r.addEnvMap(g)},p=()=>r.getScene(),_=()=>r.getRender(),m=()=>{r.refreshMap()},d=g=>{r.addPass(g)},R=g=>{r.removePass(g)};e({$$getInstance:a,convertLngLat:l,addObject:h,removeObject:u,addEnvMap:f,$$getScene:p,$$getRender:_,$$refresh:m,$$addPass:d,$$removePass:R});const y={needInitComponents:s,provideData:n,emits:i,get $amapComponent(){return r},set $amapComponent(g){r=g},$$getInstance:a,parentInstance:c,convertLngLat:l,addObject:h,removeObject:u,addEnvMap:f,$$getScene:p,$$getRender:_,$$refresh:m,$$addPass:d,$$removePass:R};return Object.defineProperty(y,"__isScriptSetup",{enumerable:!1,value:!0}),y}});function gr(o,e,t,s,n,i){return tn(o.$slots,"default")}const le=jt(mr,[["render",gr],["__file","ThreeLayer.vue"]]);le.install=o=>(o.component(le.name,le),o);const vr=le;let _r=class{constructor(e,t){this.layer=e;const s=new Ht(this.getColorHex(t.color),t.intensity);this.object=s,e.add(s)}setColor(e){this.object.color=new F(e),this.refresh()}getColorHex(e){return new F(e).getHex()}setIntensity(e){this.object.intensity=e,this.refresh()}refresh(){var e;(e=this.layer)==null||e.update()}remove(){var e;this.object&&((e=this.layer)==null||e.remove(this.object))}destroy(){this.object&&(this.object=null,this.layer=null)}};const Rr=kt({name:"ElAmapThreeLightAmbient",inheritAttrs:!1,__name:"ThreeLightAmbient",props:zt({color:{type:String,default:"#ffffff"},intensity:{type:Number,default:1}}),emits:["init"],setup(o,{expose:e,emit:t}){const s=t;let n;const{$$getInstance:i,parentInstance:r}=Kt((c,l)=>new Promise(h=>{n=new _r(l,c),h(n)}),{emits:s,destroyComponent(){n&&(r!=null&&r.$amapComponent)&&(r.isDestroy||n.remove(),n.destroy(),n=null)}});e({$$getInstance:i});const a={emits:s,get $amapComponent(){return n},set $amapComponent(c){n=c},$$getInstance:i,parentInstance:r};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}});function Tr(o,e,t,s,n,i){return sn(),nn("div")}const ue=jt(Rr,[["render",Tr],["__file","ThreeLightAmbient.vue"]]);ue.install=o=>(o.component(ue.name,ue),o);const br=ue;export{Lr as C,vr as E,dt as G,wr as I,Ue as P,ut as S,br as a,Sr as b,te as c};
