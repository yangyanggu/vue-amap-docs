import{K as z,ak as $,al as B,aq as V,k as D,n as I,b as N,au as T,av as q,M as O}from"./three.module-BVXrWKE2.js";import{b as R,u as W,E as H}from"./index-XVBT3eyP.js";import{p as E,_ as P,o as S,c as F,f as w,aj as K,a as y,d as M,w as U,ao as Z,al as J}from"./app-BIv4BGsj.js";const Q=E({name:"ElAmapLayerGlCustom",inheritAttrs:!1,__name:"GLCustom",props:R({init:{type:Function},render:{type:Function},zooms:{type:Array},opacity:{type:Number}}),emits:["init"],setup(m,{expose:l,emit:r}){const e=r;let n;const{$$getInstance:o}=W((a,C)=>new Promise(v=>{n=new AMap.GLCustomLayer(a),n.setMap(C),v(n)}),{emits:e,destroyComponent(){n&&(n.setMap(null),n=null)}});l({$$getInstance:o});const s={emits:e,get $amapComponent(){return n},set $amapComponent(a){n=a},$$getInstance:o};return Object.defineProperty(s,"__isScriptSetup",{enumerable:!1,value:!0}),s}});function X(m,l,r,e,n,o){return S(),F("div")}const h=P(Q,[["render",X],["__file","GLCustom.vue"]]);h.install=m=>(m.component(h.name,h),m);const Y=h,ee=E({__name:"gl-custom",setup(m,{expose:l}){l();let r,e,n,o=[],s=[],a=null;const C=w(14),v=w([116.54,39.79]),b=w(!0);let u=null,_=null;K(()=>{cancelAnimationFrame(_),r=null,e=null,n=null,o=null,s=null,a=null});const A={get camera(){return r},set camera(t){r=t},get renderer(){return e},set renderer(t){e=t},get scene(){return n},set scene(t){n=t},get meshes(){return o},set meshes(t){o=t},get data(){return s},set data(t){s=t},get customCoords(){return a},set customCoords(t){a=t},zoom:C,center:v,visible:b,get map(){return u},set map(t){u=t},get timer(){return _},set timer(t){_=t},switchVisible:()=>{b.value=!b.value},initMap:t=>{u=t,a=u.customCoords,s=a.lngLatsToCoords([[116.52,39.79],[116.54,39.79],[116.56,39.79]]);function c(){for(let i=0;i<o.length;i++){let{mesh:p,count:d}=o[i];d+=1,p.rotateZ(d/180*Math.PI)}u.render(),_=requestAnimationFrame(c)}c()},initGL:t=>{const c=u.getContainer(),i=c.offsetWidth,p=c.offsetHeight;r=new z(60,i/p,100,1<<30),e=new $({context:t}),e.setSize(i,p),e.autoClear=!1,n=new B;const d=new V(16777215,.3),f=new D(16777215,1);f.position.set(1e3,-100,900),n.add(f),n.add(d);const G=new I().load("https://a.amap.com/jsapi_demos/static/demo-center-v2/three.jpeg");G.minFilter=N;const k=new T({color:16773360,depthTest:!0,transparent:!0,map:G}),j=new q(1e3,1e3,1e3);for(let g=0;g<s.length;g++){const x=s[g],L=new O(j,k);L.position.set(x[0],x[1],0),o.push({mesh:L,count:g}),n.add(L)}},render:()=>{e.resetState();const{near:t,far:c,fov:i,up:p,lookAt:d,position:f}=a.getCameraParams();r.near=t,r.far=c,r.fov=i,r.position.set(...f),r.up.set(...p),r.lookAt(...d),r.updateProjectionMatrix(),e.render(n,r),e.resetState()},get ElAmap(){return H},get ElAmapLayerGlCustom(){return Y}};return Object.defineProperty(A,"__isScriptSetup",{enumerable:!1,value:!0}),A}}),te={class:"map-page-container"},ne={class:"toolbar"};function re(m,l,r,e,n,o){return S(),F(J,null,[y("div",te,[M(e.ElAmap,{center:e.center,zoom:e.zoom,"view-mode":"3D",pitch:50,onInit:e.initMap},{default:U(()=>[M(e.ElAmapLayerGlCustom,{visible:e.visible,init:e.initGL,render:e.render},null,8,["visible"])]),_:1},8,["center","zoom"])]),y("div",ne,[y("button",{onClick:l[0]||(l[0]=s=>e.switchVisible())},Z(e.visible?"隐藏":"显示"),1)])],64)}const ue=P(ee,[["render",re],["__file","gl-custom.vue"]]);export{ue as default};
