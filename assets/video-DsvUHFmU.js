import{b as w,u as V,E as A}from"./index-XVBT3eyP.js";import{p as v,f as l,_,o as f,c as g,a as u,d as y,w as E,ao as $,al as x}from"./app-BIv4BGsj.js";class C{constructor(e,s){this.canPlay=!1,this.frame=-1;const t=document.createElement("canvas");this.video=s,s.src=e.url,s.autoplay=!0,s.muted=!0,s.crossOrigin="anonymous",s.loop=e.loop;const a={...e,canvas:t};this.canvas=t,this.context=t.getContext("2d"),this.layer=new AMap.CanvasLayer(a),this.initVideoEvents(),this.load()}getLayer(){return this.layer}initVideoEvents(){var e;(e=this.video)==null||e.addEventListener("canplaythrough",()=>{var s,t;this.canvas&&(this.canvas.width=(s=this.video)==null?void 0:s.videoWidth,this.canvas.height=(t=this.video)==null?void 0:t.videoHeight),this.canPlay=!0,this.play()})}load(){var e;(e=this.video)==null||e.load()}play(){var e;this.canPlay&&((e=this.video)==null||e.play(),this.stopRender(),this.render())}pause(){var e;this.stopRender(),(e=this.video)==null||e.pause()}stopRender(){this.frame&&cancelAnimationFrame(this.frame)}render(){var e,s,t,a,i,r,o,n;this.frame=window.requestAnimationFrame(()=>{this.render()}),(e=this.video)!=null&&e.paused?(s=this.video)==null||s.play():((i=this.context)==null||i.clearRect(0,0,(t=this.canvas)==null?void 0:t.width,(a=this.canvas)==null?void 0:a.height),(n=this.context)==null||n.drawImage(this.video,0,0,(r=this.canvas)==null?void 0:r.width,(o=this.canvas)==null?void 0:o.height),this.layer.reFresh())}destroy(){this.stopRender(),this.video&&this.video.pause(),this.video=null}setUrl(e){this.stopRender(),this.canPlay=!1,this.video&&(this.video.src=e,this.load())}setZooms(e){this.getLayer().setZoom(e)}setOpacity(e){this.getLayer().setOpacity(e)}setBounds(e){this.getLayer().setBounds(e)}setzIndex(e){this.getLayer().setzIndex(e)}show(){this.getLayer().show()}hide(){this.getLayer().hide()}}const R=v({name:"ElAmapLayerVideo",inheritAttrs:!1,__name:"Video",props:w({url:{required:!0,type:String},zooms:{type:Array},bounds:{type:[Array,Object]},opacity:{type:Number}}),emits:["init"],setup(d,{expose:e,emit:s}){const t=s,a=l();let i;const{$$getInstance:r,parentInstance:o}=V((h,b)=>new Promise(L=>{i=new C(h,a.value),b.addLayer(i.getLayer()),L(i)}),{emits:t,destroyComponent(){i&&(o!=null&&o.$amapComponent)&&(o!=null&&o.isDestroy||(i.destroy(),o==null||o.$amapComponent.removeLayer(i.getLayer())),i=null)}}),n=()=>{i.play()},p=()=>{i.pause()};e({$$getInstance:r,$$play:n,$$pause:p});const m={emits:t,videoRef:a,get $amapComponent(){return i},set $amapComponent(h){i=h},$$getInstance:r,parentInstance:o,$$play:n,$$pause:p};return Object.defineProperty(m,"__isScriptSetup",{enumerable:!1,value:!0}),m}}),P={ref:"videoRef",style:{display:"none"},muted:""};function z(d,e,s,t,a,i){return f(),g("video",P,null,512)}const c=_(R,[["render",z],["__file","Video.vue"]]);c.install=d=>(d.component(c.name,c),d);const O=c,S=v({__name:"video",setup(d,{expose:e}){e();const s=l(15),t=l([116.33719,39.942384]),a=l([116.327911,39.939229,116.342659,39.946275]),i=l("https:////a.amap.com/jsapi/static/demo/third-user-demo/test.mp4"),r=l(!0),n={zoom:s,center:t,bounds:a,url:i,visible:r,switchVisible:()=>{r.value=!r.value},get ElAmap(){return A},get ElAmapLayerVideo(){return O}};return Object.defineProperty(n,"__isScriptSetup",{enumerable:!1,value:!0}),n}}),B={class:"map-page-container"},F={class:"toolbar"};function j(d,e,s,t,a,i){return f(),g(x,null,[u("div",B,[y(t.ElAmap,{center:t.center,zoom:t.zoom},{default:E(()=>[y(t.ElAmapLayerVideo,{url:t.url,bounds:t.bounds,visible:t.visible},null,8,["url","bounds","visible"])]),_:1},8,["center","zoom"])]),u("div",F,[u("button",{onClick:e[0]||(e[0]=r=>t.switchVisible())},$(t.visible?"隐藏":"显示"),1)])],64)}const q=_(S,[["render",j],["__file","video.vue"]]);export{q as default};
